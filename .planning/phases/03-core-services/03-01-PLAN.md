---
phase: 03-core-services
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/logging.ts
  - src/logging/*.ts
  - src/sessions/*.ts
  - src/terminal/*.ts
  - src/providers/*.ts
autonomous: true

must_haves:
  truths:
    - "esbuild is available as a devDependency for bulk TS type stripping"
    - "All files in src/logging/, src/sessions/, src/terminal/ are .js with no .ts remaining"
    - "All files in src/providers/ are .js with no .ts remaining"
    - "src/logging.ts barrel is converted to src/logging.js"
    - "All existing tests in these directories pass after conversion"
  artifacts:
    - path: "src/logging.js"
      provides: "Barrel re-export for logging subsystem"
    - path: "src/logging/*.js"
      provides: "Logging modules converted to JavaScript"
    - path: "src/sessions/*.js"
      provides: "Session modules converted to JavaScript"
    - path: "src/terminal/*.js"
      provides: "Terminal modules converted to JavaScript"
    - path: "src/providers/*.js"
      provides: "AI provider client modules converted to JavaScript"
  key_links:
    - from: "src/logging.js"
      to: "src/logging/*.js"
      via: "barrel re-exports"
      pattern: "export.*from.*logging/"
    - from: "src/providers/*.js"
      to: "external AI APIs"
      via: "OAuth flows and token management"
      pattern: "SECURITY:"
---

<objective>
Install esbuild as a devDependency and convert the smallest support modules (logging, sessions, terminal, providers) from TypeScript to JavaScript.

Purpose: Establishes esbuild availability for all subsequent plans and converts the leaf-like support modules that have the fewest cross-dependencies within Phase 3. These directories total ~42 files / ~4.5K lines -- small enough for manual conversion where esbuild would strip useful comments.
Output: esbuild in devDependencies, all .ts files in logging/, sessions/, terminal/, providers/ converted to .js with module-level JSDoc, SECURITY annotations on provider auth files, and all tests passing.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-services/03-RESEARCH.md
@.planning/phases/02-foundation-layer/02-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install esbuild and convert logging, sessions, and terminal</name>
  <files>
    package.json
    src/logging.ts (barrel)
    src/logging/*.ts (9 source + 5 tests = 14 files)
    src/sessions/*.ts (6 source + 1 test = 7 files)
    src/terminal/*.ts (10 source + 2 tests = 12 files)
  </files>
  <action>
1. Install esbuild as a devDependency:
   ```bash
   pnpm add -D esbuild
   ```
   Verify it's in package.json devDependencies.

2. Convert src/logging/ (14 files, ~1.9K lines) and src/logging.ts barrel (67 lines):
   - These directories are small enough for MANUAL conversion (not esbuild) to preserve existing comments
   - For each .ts file: strip type annotations, rename to .js, add module-level JSDoc comment
   - For src/logging.ts barrel: convert `export type` to JSDoc @typedef or delete, rename to src/logging.js
   - Delete `import type` lines entirely (established pattern from Phase 2)
   - Replace `as` assertions with optional chaining or remove
   - Replace `== null` / `!= null` with `=== null || === undefined` / `!== null && !== undefined`
   - Convert `export type` declarations to JSDoc @typedef or delete if unused
   - Apply QUAL-02: convert function declarations to arrow functions where appropriate

3. Convert src/sessions/ (7 files, ~388 lines):
   - Manual conversion (very small directory)
   - Same conversion patterns as above
   - src/sessions/ has 4 `as` assertions and 6 `import type` -- straightforward removal

4. Convert src/terminal/ (12 files, ~917 lines):
   - Manual conversion (small directory)
   - Same conversion patterns as above
   - src/terminal/ has 5 `as` assertions, 0 `import type`, 4 `export type` -- minimal TS patterns

5. Run eslint --fix on all converted files:
   ```bash
   pnpm eslint --fix src/logging/ src/logging.js src/sessions/ src/terminal/
   ```

6. Verify all tests pass:
   ```bash
   pnpm vitest run src/logging/ src/sessions/ src/terminal/ --reporter=verbose
   ```
  </action>
  <verify>
- `find src/logging/ src/sessions/ src/terminal/ -name '*.ts' | wc -l` returns 0
- `ls src/logging.ts` fails (barrel is now .js)
- `pnpm eslint src/logging/ src/logging.js src/sessions/ src/terminal/` reports 0 errors
- `pnpm vitest run src/logging/ src/sessions/ src/terminal/` passes all tests
  </verify>
  <done>
All logging, sessions, and terminal files are .js with module-level JSDoc comments. The src/logging.js barrel re-exports from the logging directory. All tests pass. esbuild is installed as devDependency.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert providers with SECURITY annotations</name>
  <files>
    src/providers/*.ts (4 source + 4 tests = 8 files, ~1.2K lines)
  </files>
  <action>
1. Convert src/providers/ (8 files, ~1.2K lines):
   - Manual conversion (small directory, security-sensitive)
   - Strip type annotations, rename .ts to .js
   - Delete `import type` lines (5 total in providers)
   - Remove `as` assertions (20 total) -- replace with optional chaining where needed
   - Add module-level JSDoc to each file

2. Add SECURITY: annotations to these security-sensitive provider files:
   - `github-copilot-auth.js` -- GitHub Copilot OAuth flow (document the OAuth device flow, token storage)
   - `github-copilot-token.js` -- Token exchange and caching (document token lifetime, refresh logic)
   - `qwen-portal-oauth.js` -- Qwen OAuth flow (document credential handling)
   - Pattern from 02-06: SECURITY: comments go at module-level JSDoc AND inline on security-critical operations

3. Apply QUAL-01 (early returns) and QUAL-02 (arrow functions) where appropriate in provider code

4. Run eslint --fix:
   ```bash
   pnpm eslint --fix src/providers/
   ```

5. Verify tests pass:
   ```bash
   pnpm vitest run src/providers/ --reporter=verbose
   ```
  </action>
  <verify>
- `find src/providers/ -name '*.ts' | wc -l` returns 0
- `pnpm eslint src/providers/` reports 0 errors
- `pnpm vitest run src/providers/` passes all tests
- `grep -l 'SECURITY:' src/providers/*.js | wc -l` returns at least 3 (the 3 auth files)
  </verify>
  <done>
All provider files are .js with SECURITY: annotations on OAuth/token files. Tests pass. Zero .ts files remain.
  </done>
</task>

</tasks>

<verification>
- `find src/logging/ src/sessions/ src/terminal/ src/providers/ -name '*.ts' | wc -l` returns 0
- `test ! -f src/logging.ts` (barrel converted)
- `pnpm vitest run src/logging/ src/sessions/ src/terminal/ src/providers/` all pass
- `pnpm eslint src/logging/ src/logging.js src/sessions/ src/terminal/ src/providers/` 0 errors
- esbuild is listed in devDependencies in package.json
</verification>

<success_criteria>
1. esbuild is installed as devDependency (confirmed via package.json)
2. Zero .ts files remain in src/logging/, src/sessions/, src/terminal/, src/providers/
3. src/logging.ts barrel converted to src/logging.js
4. All files have module-level JSDoc comments
5. Provider auth files have SECURITY: annotations
6. All existing tests pass
7. ESLint reports 0 errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-services/03-01-SUMMARY.md`
</output>
