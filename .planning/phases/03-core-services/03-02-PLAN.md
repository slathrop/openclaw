---
phase: 03-core-services
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/memory/*.ts
  - src/plugins/*.ts
autonomous: true

must_haves:
  truths:
    - "All files in src/memory/ are .js with no .ts remaining"
    - "All files in src/plugins/ are .js with no .ts remaining"
    - "Memory classes use underscore-prefix convention for private fields"
    - "Memory classes have @implements JSDoc for interface compliance"
    - "All existing tests in memory/ and plugins/ pass after conversion"
  artifacts:
    - path: "src/memory/*.js"
      provides: "Memory management modules converted to JavaScript"
    - path: "src/plugins/*.js"
      provides: "Plugin system modules converted to JavaScript"
  key_links:
    - from: "src/memory/manager.js"
      to: "src/memory/sqlite.js"
      via: "database layer"
      pattern: "SECURITY:"
    - from: "src/plugins/*.js"
      to: "src/agents/ and channel directories"
      via: ".js extension imports (resolve to .ts during transition)"
      pattern: "import.*from"
---

<objective>
Convert the memory subsystem (39 files, ~8.9K lines) and plugin system (37 files, ~7.3K lines) from TypeScript to JavaScript using esbuild bulk conversion.

Purpose: Memory and plugins are moderately complex support modules imported by gateway and agents. Memory has the highest concentration of `private` keywords (156 occurrences) and 3 classes implementing `MemorySearchManager` interface -- both require careful post-processing. Plugins has extensive cross-module imports to Phase 4+ directories (channels, CLI), which are NOT a problem since .js imports resolve to .ts during transition.
Output: All 76 files converted to .js with underscore-prefix private fields in memory classes, @implements JSDoc annotations, SECURITY comments on manager.js and sqlite.js, and all tests passing.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-services/03-RESEARCH.md
@.planning/phases/02-foundation-layer/02-06-SUMMARY.md
@.planning/phases/02-foundation-layer/02-08-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert memory subsystem with private field and interface handling</name>
  <files>
    src/memory/*.ts (26 source + 13 tests = 39 files, ~8.9K lines)
  </files>
  <action>
1. Use esbuild bulk conversion for src/memory/ (39 files, too many for manual):
   - Write a conversion script using esbuild `transformSync` (see 03-RESEARCH.md for exact script)
   - Walk all .ts files in src/memory/, transform each to .js, delete .ts originals
   - Skip any .d.ts files

2. Post-process: Private keyword to underscore prefix (156 occurrences concentrated here):
   - esbuild strips the `private` keyword automatically, but fields need `_` prefix
   - For each class in memory/: prefix all private fields/methods with `_`
   - Update ALL internal references within each class (this.field -> this._field)
   - Key classes: MemoryIndexManager (~most private fields), plus 2 other MemorySearchManager implementors
   - Follow the 02-08 pattern established with IncludeProcessor

3. Post-process: `implements` keyword removal and JSDoc:
   - esbuild removes `implements MemorySearchManager` automatically
   - Add `@implements {MemorySearchManager}` JSDoc annotation to each of the 3 classes
   - Convert the `interface MemorySearchManager` declaration (likely in types.ts) to JSDoc @typedef
   - Convert the remaining interface declaration (1 total in memory/) to JSDoc @typedef

4. Post-process: Fix esbuild artifacts:
   - Replace `== null` / `!= null` with `=== null || === undefined` / `!== null && !== undefined`
   - Remove any leftover unused imports (esbuild may leave value imports that were type-only)
   - Add module-level JSDoc comments to each source file

5. Add SECURITY: annotations to:
   - `manager.js` -- Memory data persistence and search (document data storage, access patterns)
   - `sqlite.js` -- Database access layer (document SQL injection prevention, file access)

6. Apply QUAL-01 (early returns) and QUAL-02 (arrow functions) to obviously improvable patterns

7. Run eslint --fix:
   ```bash
   pnpm eslint --fix src/memory/
   ```

8. Verify tests pass:
   ```bash
   pnpm vitest run src/memory/ --reporter=verbose
   ```
  </action>
  <verify>
- `find src/memory/ -name '*.ts' | wc -l` returns 0
- `pnpm eslint src/memory/` reports 0 errors
- `pnpm vitest run src/memory/` passes all tests
- `grep -l 'SECURITY:' src/memory/*.js | wc -l` returns at least 2
- `grep -rn '_db\|_config\|_sync' src/memory/*.js | head -5` shows underscore-prefixed private fields
  </verify>
  <done>
All 39 memory files are .js. Private fields use underscore prefix convention. Interface implementations have @implements JSDoc. SECURITY annotations on manager.js and sqlite.js. All tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert plugin system</name>
  <files>
    src/plugins/*.ts (29 source + 8 tests = 37 files, ~7.3K lines)
  </files>
  <action>
1. Use esbuild bulk conversion for src/plugins/ (37 files):
   - Same esbuild transformSync approach as Task 1
   - Walk all .ts files, transform to .js, delete .ts originals

2. Post-process: Handle export type declarations (108 total in plugins -- highest of any Phase 3 directory):
   - esbuild removes `export type` declarations automatically
   - For important exported types that downstream consumers reference: add JSDoc @typedef
   - For types that are only used within the file: delete without replacement

3. Post-process: Fix esbuild artifacts:
   - Replace `== null` / `!= null` with strict equality
   - Remove unused imports
   - Add module-level JSDoc comments
   - Handle any `import type` remnants (62 total -- esbuild removes these)

4. Note: plugins/ has extensive imports from Phase 4+ directories (channels, CLI, commands). These use .js extension imports and resolve to .ts files during transition. Do NOT modify any import paths.

5. Apply QUAL-01/QUAL-02 where obviously beneficial

6. Run eslint --fix:
   ```bash
   pnpm eslint --fix src/plugins/
   ```

7. Verify tests pass:
   ```bash
   pnpm vitest run src/plugins/ --reporter=verbose
   ```
  </action>
  <verify>
- `find src/plugins/ -name '*.ts' | wc -l` returns 0
- `pnpm eslint src/plugins/` reports 0 errors
- `pnpm vitest run src/plugins/` passes all tests
  </verify>
  <done>
All 37 plugin files are .js with module-level JSDoc. Export types converted to JSDoc @typedef where needed. Cross-module imports to Phase 4+ directories preserved with .js extensions. All tests pass.
  </done>
</task>

</tasks>

<verification>
- `find src/memory/ src/plugins/ -name '*.ts' | wc -l` returns 0
- `pnpm vitest run src/memory/ src/plugins/` all pass
- `pnpm eslint src/memory/ src/plugins/` 0 errors
- Memory classes use `_` prefix for private fields
- SECURITY annotations present on memory/manager.js and memory/sqlite.js
</verification>

<success_criteria>
1. Zero .ts files remain in src/memory/ and src/plugins/
2. Memory classes use underscore-prefix private field convention
3. Memory classes have @implements JSDoc annotation
4. MemorySearchManager interface converted to JSDoc @typedef
5. SECURITY annotations on manager.js and sqlite.js
6. All module-level JSDoc comments present
7. All existing tests pass
8. ESLint reports 0 errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-services/03-02-SUMMARY.md`
</output>
