---
phase: 03-core-services
plan: 08
type: execute
wave: 2
depends_on: ["03-01", "03-05"]
files_modified:
  - src/agents/*.test.ts (root-level test files only)
  - src/agents/test-helpers/*.ts
autonomous: true

must_haves:
  truths:
    - "All root-level test files in src/agents/ are .js with no .test.ts remaining"
    - "All test helper files in src/agents/test-helpers/ are .js"
    - "All root-level agent tests pass after conversion"
    - "Zero .ts files at src/agents/ root level (combined with 03-05)"
  artifacts:
    - path: "src/agents/*.test.js"
      provides: "Agent root test files converted to JavaScript"
    - path: "src/agents/test-helpers/*.js"
      provides: "Agent test helper files converted to JavaScript"
  key_links:
    - from: "src/agents/*.test.js"
      to: "src/agents/*.js"
      via: "test imports of converted source modules"
      pattern: "import.*from.*\\./"
    - from: "src/agents/test-helpers/*.js"
      to: "src/agents/*.js"
      via: "shared test utilities for agent tests"
      pattern: "import.*test-helpers"
---

<objective>
Convert all root-level test files in src/agents/ (~183 files, ~26K lines) and test helpers (~2 files) from TypeScript to JavaScript, then verify the full root-level agent test suite passes.

Purpose: These test files were split from 03-05 (agent source) to keep each plan within context budget. Source files must be converted first (03-05) so that test imports resolve correctly. After this plan, zero .ts files remain at the src/agents/ root level.
Output: All ~185 root-level agent test files and helpers converted to .js, root-level agent test suite passing.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-services/03-RESEARCH.md
@.planning/phases/03-core-services/03-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bulk convert agents root-level test files (batch 1: A-M)</name>
  <files>
    src/agents/[a-m]*.test.ts (root-level test files alphabetically A through M)
    src/agents/test-helpers/*.ts (2 test helper files)
    Estimated: ~93 test files + 2 helpers
  </files>
  <action>
1. Use esbuild bulk conversion on the first batch of root-level test files:
   - Convert all *.test.ts files directly in src/agents/ whose names start with a-m (maxdepth 1)
   - Also convert src/agents/test-helpers/*.ts (2 shared test utility files)
   - esbuild transformSync, write .js, delete .ts

2. Post-process test files:
   - Replace `== null` / `!= null` with strict equality
   - Remove unused type imports
   - Fix multi-line `as` cast patterns -> direct property access (per 02-09 pattern)
   - No SECURITY comments or QUAL improvements needed in tests

3. Note: Some test files have extremely long names (per research Pitfall 9). Use programmatic rename, not manual.

4. Run eslint --fix on converted batch:
   ```bash
   pnpm eslint --fix src/agents/[a-m]*.test.js src/agents/test-helpers/
   ```
  </action>
  <verify>
- Spot check several a-m test files are now .js
- `find src/agents/test-helpers/ -name '*.ts' | wc -l` returns 0
- `pnpm eslint src/agents/[a-m]*.test.js src/agents/test-helpers/` reports 0 errors
  </verify>
  <done>
First batch (~93) of root-level agent test files and 2 test helper files are .js with esbuild artifacts fixed and ESLint passing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Bulk convert agents root-level test files (batch 2: N-Z) and verify</name>
  <files>
    src/agents/[n-z]*.test.ts (root-level test files alphabetically N through Z)
    Estimated: ~90 test files
  </files>
  <action>
1. Use esbuild bulk conversion on the second batch of root-level test files:
   - Convert all remaining *.test.ts files directly in src/agents/ (names starting n-z, maxdepth 1)
   - esbuild transformSync, write .js, delete .ts

2. Post-process test files:
   - Replace `== null` / `!= null` with strict equality
   - Remove unused type imports
   - Fix multi-line `as` cast patterns -> direct property access

3. Run eslint --fix on converted batch:
   ```bash
   pnpm eslint --fix src/agents/[n-z]*.test.js
   ```

4. Run root-level agent tests:
   ```bash
   pnpm vitest run src/agents/*.test.js --reporter=verbose
   ```
   (This runs only root-level tests, not subdirectory tests which are handled by 03-06)

   If vitest glob does not work, use:
   ```bash
   pnpm vitest run --dir src/agents --reporter=verbose --ignore 'src/agents/*/'
   ```

5. Verify zero .ts at root level:
   ```bash
   find src/agents/ -maxdepth 1 -name '*.ts' | wc -l
   ```

6. If any tests fail, diagnose and fix:
   - Common issue: import paths still reference .ts extensions
   - Common issue: test mocks reference old private field names (should now use underscore prefix from 03-05)
   - Common issue: type-only imports left behind causing runtime errors
  </action>
  <verify>
- `find src/agents/ -maxdepth 1 -name '*.ts' | wc -l` returns 0
- `find src/agents/test-helpers/ -name '*.ts' | wc -l` returns 0
- `pnpm eslint src/agents/*.test.js` reports 0 errors
- Root-level agent tests pass
  </verify>
  <done>
All 183 root-level agent test files and 2 test helper files are .js. Root-level agent tests pass. Zero .ts files at agents root level. Combined with 03-05, the root level of src/agents/ is fully converted.
  </done>
</task>

</tasks>

<verification>
- `find src/agents/ -maxdepth 1 -name '*.ts' | wc -l` returns 0
- `find src/agents/test-helpers/ -name '*.ts' | wc -l` returns 0
- Root-level agent tests pass
- `pnpm eslint src/agents/*.test.js` 0 errors
</verification>

<success_criteria>
1. Zero .ts files at src/agents/ root level (maxdepth 1)
2. Zero .ts files in src/agents/test-helpers/
3. All root-level agent tests pass
4. ESLint reports 0 errors on test files
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-services/03-08-SUMMARY.md`
</output>
