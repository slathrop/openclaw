---
phase: 03-core-services
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/gateway/protocol/*.ts
  - src/gateway/protocol/schema/*.ts
autonomous: true

must_haves:
  truths:
    - "All files in src/gateway/protocol/ are .js with no .ts remaining"
    - "TypeBox/Zod schema files retain their runtime schema definitions unchanged"
    - "Protocol types.ts converted to JSDoc typedef-only file"
    - "All existing tests in gateway/protocol/ pass after conversion"
  artifacts:
    - path: "src/gateway/protocol/*.js"
      provides: "Gateway protocol layer converted to JavaScript"
    - path: "src/gateway/protocol/schema/*.js"
      provides: "TypeBox and Zod schema definitions (near-pure JS already)"
  key_links:
    - from: "src/gateway/protocol/schema/*.js"
      to: "@sinclair/typebox"
      via: "TypeBox Type.Object() definitions"
      pattern: "Type\\."
    - from: "src/gateway/protocol/schema/types.js"
      to: "all protocol schema files"
      via: "JSDoc @typedef re-exports"
      pattern: "@typedef"
---

<objective>
Convert the gateway protocol layer (protocol/ subdirectory with TypeBox/Zod schemas) from TypeScript to JavaScript.

Purpose: The protocol layer defines the gateway's WebSocket message schemas using TypeBox and Zod. These files are near-pure JavaScript already (runtime schema definitions) and need minimal conversion -- primarily removing `import type` lines, converting `Static<>` type extractions to JSDoc, and renaming .ts to .js. This is separated from the main gateway conversion (03-04) because protocol schemas are a distinct concern and much simpler to convert.
Output: All ~21 protocol files converted to .js. TypeBox/Zod schema definitions preserved unchanged. types.ts converted to JSDoc typedef-only file.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-services/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert gateway protocol schema files (TypeBox/Zod)</name>
  <files>
    src/gateway/protocol/schema/*.ts (~17 files, ~2K lines)
  </files>
  <action>
1. These files are near-pure JavaScript already (TypeBox Type.Object() and Zod z.object() calls). Conversion is minimal:
   - For each schema file: rename .ts to .js
   - Delete `import type` lines
   - Convert `export type Foo = Static<typeof FooSchema>` to JSDoc: `/** @typedef {import('@sinclair/typebox').Static<typeof FooSchema>} Foo */` or delete if only used for TypeScript type checking
   - Add module-level JSDoc comment explaining the schema's purpose
   - The z.object() and Type.Object() calls require NO changes -- they are runtime JavaScript

2. Special handling for `types.ts` (226 lines -- entirely type exports):
   - This file is all `import type` + `export type` + `Static<>` type utilities
   - Convert to a JSDoc typedef-only file (same pattern as config types in Phase 2)
   - Each `export type Foo = Static<typeof FooSchema>` becomes a JSDoc @typedef
   - If the file becomes empty/useless after conversion, keep it as a JSDoc-only file for documentation or delete if nothing imports from it

3. Run eslint --fix:
   ```bash
   pnpm eslint --fix src/gateway/protocol/schema/
   ```
  </action>
  <verify>
- `find src/gateway/protocol/schema/ -name '*.ts' | wc -l` returns 0
- `pnpm eslint src/gateway/protocol/schema/` reports 0 errors
- TypeBox Type.Object() calls are unchanged in the converted files
  </verify>
  <done>
All protocol schema files are .js. TypeBox/Zod runtime definitions are preserved unchanged. types.ts is a JSDoc typedef-only file.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert remaining gateway protocol files and verify</name>
  <files>
    src/gateway/protocol/*.ts (root-level protocol files, ~3-4 files, ~700 lines)
    src/gateway/protocol/**/*.test.ts (1 test file)
  </files>
  <action>
1. Convert the root-level protocol files (outside schema/ subdirectory):
   - These are likely protocol handler/registry files, not pure schema
   - Use manual conversion (small number of files)
   - Strip type annotations, `import type` lines, `as` assertions
   - Replace `== null` / `!= null` with strict equality
   - Add module-level JSDoc

2. Convert any test file(s) in protocol/:
   - Same conversion patterns
   - Rename .test.ts to .test.js

3. Apply QUAL-01/QUAL-02 where obviously beneficial

4. Run eslint --fix and verify tests:
   ```bash
   pnpm eslint --fix src/gateway/protocol/
   pnpm vitest run src/gateway/protocol/ --reporter=verbose
   ```
  </action>
  <verify>
- `find src/gateway/protocol/ -name '*.ts' | wc -l` returns 0
- `pnpm eslint src/gateway/protocol/` reports 0 errors
- `pnpm vitest run src/gateway/protocol/` passes (if tests exist)
  </verify>
  <done>
All gateway protocol files (schema + root) are .js. All tests pass. Zero .ts files remain in protocol/.
  </done>
</task>

</tasks>

<verification>
- `find src/gateway/protocol/ -name '*.ts' | wc -l` returns 0
- `pnpm eslint src/gateway/protocol/` 0 errors
- TypeBox/Zod runtime schema calls are unchanged
- Any protocol tests pass
</verification>

<success_criteria>
1. Zero .ts files remain in src/gateway/protocol/ and its subdirectories
2. TypeBox Type.Object() and Zod z.object() schema definitions are unchanged
3. types.ts converted to JSDoc typedef-only or appropriately simplified
4. All files have module-level JSDoc comments
5. All tests pass
6. ESLint reports 0 errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-services/03-03-SUMMARY.md`
</output>
