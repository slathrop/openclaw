---
phase: 03-core-services
plan: 07
type: execute
wave: 2
depends_on: ["03-01", "03-04"]
files_modified:
  - src/gateway/*.test.ts
  - src/gateway/test-helpers*.ts
  - src/gateway/server/*.test.ts
  - src/gateway/server-methods/*.test.ts
autonomous: true

must_haves:
  truths:
    - "All gateway test files are .js with no .test.ts remaining"
    - "All gateway test helper files are .js"
    - "All gateway tests pass after conversion"
    - "Zero .ts files remain anywhere in src/gateway/ (combined with 03-03 and 03-04)"
  artifacts:
    - path: "src/gateway/*.test.js"
      provides: "Gateway root test files converted to JavaScript"
    - path: "src/gateway/server/*.test.js"
      provides: "Gateway server test files converted to JavaScript"
    - path: "src/gateway/server-methods/*.test.js"
      provides: "Gateway server-methods test files converted to JavaScript"
  key_links:
    - from: "src/gateway/*.test.js"
      to: "src/gateway/*.js"
      via: "test imports of converted source modules"
      pattern: "import.*from.*\\./"
    - from: "src/gateway/test-helpers*.js"
      to: "src/gateway/server/*.js"
      via: "shared test utilities for gateway tests"
      pattern: "import.*test-helpers"
---

<objective>
Convert all gateway test files and test helpers (~62 files) from TypeScript to JavaScript and verify the full gateway test suite passes.

Purpose: These test files were split from 03-04 (gateway source) to keep each plan within context budget. Source files must be converted first (03-04) so that test imports resolve correctly. After this plan, zero .ts files remain anywhere in src/gateway/.
Output: All gateway test files and helpers converted to .js, full gateway test suite passing.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-services/03-RESEARCH.md
@.planning/phases/03-core-services/03-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bulk convert gateway test files with esbuild</name>
  <files>
    src/gateway/*.test.ts (51 root test files)
    src/gateway/server/*.test.ts (1 test)
    src/gateway/server-methods/*.test.ts (5 tests)
    src/gateway/test-helpers*.ts (5 test helper files)
    Total: ~62 files
  </files>
  <action>
1. Use esbuild bulk conversion on ALL gateway test files:
   - Convert all *.test.ts files in gateway/ and its subdirectories (excluding protocol/ if already done by 03-03)
   - Convert test-helpers*.ts files (shared test utilities)
   - esbuild transformSync, rename .ts to .js, delete .ts originals

2. Post-process test files:
   - Replace `== null` / `!= null` with strict equality
   - Remove unused type imports
   - Fix any broken test patterns (e.g., multi-line `as` cast patterns -> direct property access, per 02-09 pattern)
   - No need for SECURITY comments or QUAL improvements in tests

3. Run eslint --fix on test files:
   ```bash
   pnpm eslint --fix src/gateway/*.test.js src/gateway/test-helpers*.js src/gateway/server/*.test.js src/gateway/server-methods/*.test.js
   ```
  </action>
  <verify>
- `find src/gateway/ -name '*.test.ts' ! -path '*/protocol/*' | wc -l` returns 0
- `find src/gateway/ -name 'test-helpers*.ts' | wc -l` returns 0
- `pnpm eslint src/gateway/*.test.js src/gateway/test-helpers*.js` reports 0 errors
  </verify>
  <done>
All ~62 gateway test files and test helpers are .js with esbuild artifacts fixed and ESLint passing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run full gateway test suite and verify zero .ts files</name>
  <files>
    (no new files -- verification only)
  </files>
  <action>
1. Run the full gateway test suite:
   ```bash
   pnpm vitest run src/gateway/ --reporter=verbose
   ```
   - Expect: all unit tests pass
   - E2E tests (*.e2e.test.js) may need gateway running -- verify they pass or are appropriately skipped
   - Live tests (*.live.test.js) are skipped without CLAWDBOT_LIVE_TEST=1

2. Verify zero .ts files remain anywhere in src/gateway/:
   ```bash
   find src/gateway/ -name '*.ts' | wc -l
   ```
   This should return 0 (protocol/ was handled by 03-03, source by 03-04, tests by this plan).

3. If any tests fail, diagnose and fix:
   - Common issue: import paths still reference .ts extensions
   - Common issue: test mocks reference old private field names (should now use underscore prefix)
   - Common issue: type-only imports left behind causing runtime errors
  </action>
  <verify>
- `find src/gateway/ -name '*.ts' | wc -l` returns 0 (including protocol/ from 03-03)
- `pnpm vitest run src/gateway/` passes all runnable tests
- `pnpm eslint src/gateway/` reports 0 errors
  </verify>
  <done>
Full gateway test suite passes. Zero .ts files remain anywhere in src/gateway/. The entire gateway directory is fully converted to JavaScript.
  </done>
</task>

</tasks>

<verification>
- `find src/gateway/ -name '*.ts' | wc -l` returns 0
- `pnpm vitest run src/gateway/` all tests pass
- `pnpm eslint src/gateway/` 0 errors
</verification>

<success_criteria>
1. Zero .ts files remain in src/gateway/ (all subdirectories including protocol/)
2. All gateway tests pass (unit + e2e where applicable)
3. ESLint reports 0 errors across all gateway files
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-services/03-07-SUMMARY.md`
</output>
