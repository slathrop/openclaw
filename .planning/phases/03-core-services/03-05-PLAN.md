---
phase: 03-core-services
plan: 05
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/agents/*.ts (root-level source only, NOT test files)
autonomous: true

must_haves:
  truths:
    - "All root-level source files in src/agents/ are .js with no .ts remaining"
    - "Security-sensitive agent files have SECURITY: annotations"
    - "satisfies assertions (concentrated in agents) are removed"
    - "Agent private class fields use underscore prefix convention"
  artifacts:
    - path: "src/agents/*.js"
      provides: "Agent runtime root modules converted to JavaScript"
  key_links:
    - from: "src/agents/cli-credentials.js"
      to: "credential storage"
      via: "CLI credential management"
      pattern: "SECURITY:"
    - from: "src/agents/model-auth.js"
      to: "API key resolution"
      via: "model authentication"
      pattern: "SECURITY:"
---

<objective>
Convert all root-level source files in src/agents/ (~108 files, ~22.5K lines) from TypeScript to JavaScript using esbuild bulk conversion. Test files (~185 files) are handled separately by 03-08.

Purpose: The agents root level contains the core agent runtime (model selection, Pi embedded session management, message handling, tool dispatch). This is the largest directory in Phase 3. Splitting source from tests keeps context budget under 50%.
Output: All ~108 root-level agent source files converted to .js with SECURITY annotations on credential files, satisfies assertions removed, and module-level JSDoc.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-services/03-RESEARCH.md
@.planning/phases/02-foundation-layer/02-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bulk convert agents root-level source files (batch 1: A-M)</name>
  <files>
    src/agents/[a-m]*.ts (root-level source files alphabetically A through M, excluding *.test.ts)
    Estimated: ~54 files
  </files>
  <action>
1. Use esbuild bulk conversion on the first alphabetical batch of root-level agents source files:
   - Convert all .ts files directly in src/agents/ whose names start with a-m (maxdepth 1, not recursive)
   - Do NOT convert *.test.ts files (handled by 03-08)
   - Do NOT convert files in subdirectories (tools/, pi-embedded-runner/, etc.) -- those are 03-06
   - esbuild transformSync for each file, write .js, delete .ts

2. Post-process: Handle agents-specific TS patterns:
   - `satisfies` assertions (~99 occurrences, mostly in root files) -- esbuild removes automatically, no action needed
   - `as` assertions (549 total across agents, many in root) -- esbuild removes automatically
   - `import type` (419 total) -- esbuild removes automatically
   - `export type` (185 total) -- esbuild removes; add JSDoc @typedef for important exported types
   - `interface` declarations (9 in agents) -- convert to JSDoc @typedef
   - Generic functions (27 total) -- simplify to non-generic JSDoc (e.g., Promise<*>)
   - `private` keyword (2 in agents root) -- underscore prefix

3. Post-process: Fix esbuild artifacts:
   - Replace `== null` / `!= null` with strict equality
   - Remove unused imports
   - Fix empty catch blocks with explanatory comments
   - Add module-level JSDoc comments to each source file

4. Add SECURITY: annotations to credential-related files found in this batch:
   - `cli-credentials.js` -- CLI credential management (document credential storage and retrieval)
   - `model-auth.js` -- Model API key resolution (document API key lookup chain)
   (Note: if these names fall outside a-m alphabetically, they will be in Task 2 instead)

5. Apply QUAL-01 (early returns) and QUAL-02 (arrow functions) to obviously improvable patterns

6. Run eslint --fix on converted files:
   ```bash
   pnpm eslint --fix src/agents/[a-m]*.js
   ```
  </action>
  <verify>
- Source files in the a-m range at src/agents/ root are .js (spot check several)
- `pnpm eslint src/agents/[a-m]*.js` reports 0 errors
  </verify>
  <done>
First batch (~54) of root-level agent source files are .js with module-level JSDoc, SECURITY annotations where applicable, and interfaces converted to JSDoc @typedef. ESLint passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Bulk convert agents root-level source files (batch 2: N-Z)</name>
  <files>
    src/agents/[n-z]*.ts (root-level source files alphabetically N through Z, excluding *.test.ts)
    Estimated: ~54 files
  </files>
  <action>
1. Use esbuild bulk conversion on the second alphabetical batch of root-level agents source files:
   - Convert all remaining .ts source files directly in src/agents/ (names starting n-z, maxdepth 1)
   - Do NOT convert *.test.ts files (handled by 03-08)
   - Do NOT convert files in subdirectories -- those are 03-06
   - esbuild transformSync for each file, write .js, delete .ts

2. Post-process: Same patterns as Task 1:
   - Fix esbuild artifacts (== null, unused imports, empty catch blocks)
   - Add module-level JSDoc comments
   - Convert remaining `export type` / `interface` to JSDoc @typedef
   - Underscore prefix any remaining `private` fields

3. Add SECURITY: annotations to any remaining credential-related files in this batch

4. Apply QUAL-01 (early returns) and QUAL-02 (arrow functions) where appropriate

5. Run eslint --fix on all converted source files:
   ```bash
   pnpm eslint --fix src/agents/[n-z]*.js
   ```

6. Final verification -- zero source .ts at root level:
   ```bash
   find src/agents/ -maxdepth 1 -name '*.ts' ! -name '*.test.ts' | wc -l
   ```
  </action>
  <verify>
- `find src/agents/ -maxdepth 1 -name '*.ts' ! -name '*.test.ts' | wc -l` returns 0
- `pnpm eslint src/agents/*.js` reports 0 errors (root-level source only)
- `grep -l 'SECURITY:' src/agents/cli-credentials.js src/agents/model-auth.js | wc -l` returns 2
  </verify>
  <done>
All 108 root-level agent source files are .js with module-level JSDoc, SECURITY annotations on credential files, and interfaces converted to JSDoc @typedef. ESLint passes. Test files remain as .ts for 03-08.
  </done>
</task>

</tasks>

<verification>
- `find src/agents/ -maxdepth 1 -name '*.ts' ! -name '*.test.ts' | wc -l` returns 0
- `pnpm eslint src/agents/*.js` 0 errors
- SECURITY annotations on cli-credentials.js and model-auth.js
- Interface declarations converted to JSDoc @typedef
</verification>

<success_criteria>
1. Zero source .ts files at src/agents/ root level (test files may remain)
2. SECURITY annotations on cli-credentials.js and model-auth.js
3. Interface declarations converted to JSDoc @typedef
4. All module-level JSDoc comments present
5. ESLint reports 0 errors on source files
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-services/03-05-SUMMARY.md`
</output>
