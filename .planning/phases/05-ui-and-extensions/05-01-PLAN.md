---
phase: 05-ui-and-extensions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ui/src/ui/**/*.ts -> *.js (113 files)
  - ui/vite.config.ts -> ui/vite.config.js
  - ui/vitest.config.ts -> ui/vitest.config.js
  - ui/index.html (entry point reference)
  - ui/src/ui/__screenshots__/ (directory renames)
autonomous: true

must_haves:
  truths:
    - "All 113 .ts files in ui/src/ are converted to .js with no remaining .ts files"
    - "Lit decorator files (app.ts, resizable-divider.ts) use static properties + constructor, not decorator syntax"
    - "All 350 internal import paths rewritten from .ts to .js"
    - "3 declare global blocks removed (app, resizable-divider, assistant-identity)"
    - "Vite dev server can resolve and serve the converted .js source files"
    - "ui/vitest.config.js includes pattern updated to *.test.js"
  artifacts:
    - path: "ui/src/ui/app.js"
      provides: "Main Lit app component with static properties (no decorators)"
      contains: "static properties"
    - path: "ui/src/ui/components/resizable-divider.js"
      provides: "Resizable divider component with static properties (no decorators)"
      contains: "customElements.define"
    - path: "ui/vite.config.js"
      provides: "Vite config for JS source"
    - path: "ui/vitest.config.js"
      provides: "Vitest config with .test.js include pattern"
  key_links:
    - from: "ui/index.html"
      to: "ui/src/ui/main.js"
      via: "script module src attribute"
      pattern: 'src=.*main\\.js'
    - from: "ui/src/ui/*.js"
      to: "ui/src/ui/*.js"
      via: "import paths use .js extensions"
      pattern: "from.*\\.js"
---

<objective>
Convert the web UI source (113 Lit-based TypeScript files) to JavaScript and update Vite/Vitest configuration.

Purpose: The web UI uses Lit (web components), NOT React. Two files use Lit decorators that need manual conversion to static properties + constructor pattern. All 350 internal import paths use .ts extensions (unlike src/ which uses .js) and must be rewritten. Three declare global blocks must be removed (esbuild does not strip them).

Output: All ui/src/ files converted to .js, Vite and Vitest configs renamed and updated, index.html entry point updated.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-and-extensions/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert 113 UI source and test files to JavaScript</name>
  <files>
    ui/src/ui/**/*.ts (113 files -> .js)
    A conversion script (convert-ui.mjs, deleted after use)
  </files>
  <action>
Create a conversion script `convert-ui.mjs` at project root that:

1. Finds all .ts files in ui/src/ recursively (excluding .d.ts)
2. For each file, reads content and applies the established esbuild pipeline:
   - esbuild `transformSync` with loader: 'ts', format: 'esm' (NO keepNames)
   - Strip any `__defProp`/`__name` boilerplate (safety measure)
   - Rewrite import paths: `.ts"` -> `.js"` and `.ts'` -> `.js'` in import/export statements (critical: UI uses .ts extensions unlike src/)
   - Replace `== null` with `=== null || === undefined` and `!= null` with `!== null && !== undefined` (word-boundary regex from Phase 4)
   - Add explanatory comments to empty catch blocks
   - Remove `declare global { ... }` blocks (regex: `/\ndeclare global \{[\s\S]*?\n\}\n?/g`)
3. Writes .js file alongside .ts file
4. Deletes the .ts file
5. Reports count of files converted

THEN manually convert the 2 Lit decorator files (DO NOT use esbuild for these):

**ui/src/ui/app.ts** (~70 @state properties):
- Remove `import { customElement, state, property } from "lit/decorators.js"`
- Convert all `@state()` properties to entries in `static properties = { propName: { state: true }, ... }`
- Convert all `@property({...})` properties to entries in `static properties` with their options
- Move ALL reactive property initializations from class fields to `constructor()` after `super()` call
- Move non-reactive fields (private, underscore-prefixed) to constructor too
- Remove `@customElement("openclaw-app")` decorator
- Add `customElements.define("openclaw-app", OpenClawApp)` after class declaration
- Remove the `declare global` block (Window augmentation)

**ui/src/ui/components/resizable-divider.ts**:
- Same decorator-to-static-properties conversion
- Convert `@property({ type: Number })` entries
- Move private fields to constructor with underscore prefix
- Add `customElements.define("resizable-divider", ResizableDivider)` after class
- Remove `declare global` block (HTMLElementTagNameMap)

Also handle **ui/src/ui/assistant-identity.ts**: remove its `declare global` block (Window augmentation). This file has no decorators, just a declare global that esbuild won't strip.

Run the bulk conversion script first, then overwrite the 2 decorator files with manual conversions, then verify all 3 declare global blocks are gone.

Run `pnpm check -- ui/src/ --fix` to auto-format all converted files.

Delete the conversion script after use.
  </action>
  <verify>
    - `find ui/src -name '*.ts' | wc -l` returns 0
    - `grep -r 'declare global' ui/src/ | wc -l` returns 0
    - `grep -r "from.*\.ts['\"]" ui/src/ | wc -l` returns 0 (no .ts import paths remain)
    - `grep -r 'static properties' ui/src/ui/app.js` returns a match
    - `grep -r 'customElements.define' ui/src/ui/app.js` returns a match
    - `pnpm check -- ui/src/` passes (or only pre-existing warnings)
  </verify>
  <done>All 113 UI files converted to .js. Lit decorators replaced with static properties + constructor. All .ts import paths rewritten to .js. All declare global blocks removed. ESLint passes.</done>
</task>

<task type="auto">
  <name>Task 2: Update Vite config, Vitest config, index.html, and screenshot directories</name>
  <files>
    ui/vite.config.ts -> ui/vite.config.js
    ui/vitest.config.ts -> ui/vitest.config.js
    ui/index.html
    ui/src/ui/__screenshots__/ (directory renames)
  </files>
  <action>
1. **ui/vite.config.ts -> ui/vite.config.js**: Read file, strip any type annotations with esbuild transformSync, write as .js, delete .ts. The file likely has minimal TS (just import types if any).

2. **ui/vitest.config.ts -> ui/vitest.config.js**: Read file, strip types, update include pattern from `src/**/*.test.ts` to `src/**/*.test.js`, write as .js, delete .ts.

3. **ui/index.html**: Change the script module src from `main.ts` to `main.js`:
   - Find the line like `<script type="module" src="/src/ui/main.ts">` and change `.ts` to `.js`

4. **Screenshot directories** (if they exist):
   - Rename `ui/src/ui/__screenshots__/navigation.browser.test.ts/` to `navigation.browser.test.js/`
   - Rename `ui/src/ui/__screenshots__/config-form.browser.test.ts/` to `config-form.browser.test.js/`
   - These are DIRECTORIES containing baseline screenshots, not files

5. Verify the Vite dev build can resolve modules: run `cd ui && npx vite build --mode development 2>&1 | tail -20` (should not show module resolution errors). If Vite is not set up for standalone build, skip this and verify via grep that entry point resolves.
  </action>
  <verify>
    - `ls ui/vite.config.js` exists, `ls ui/vite.config.ts 2>/dev/null` does not exist
    - `ls ui/vitest.config.js` exists, `ls ui/vitest.config.ts 2>/dev/null` does not exist
    - `grep 'main.js' ui/index.html` returns a match
    - `grep '\.test\.js' ui/vitest.config.js` returns a match
    - `find ui -name '*.ts' | wc -l` returns 0 (zero .ts files in entire ui/ directory)
  </verify>
  <done>Vite and Vitest configs converted to .js. index.html references main.js. Screenshot directories renamed. Zero .ts files remain anywhere in ui/.</done>
</task>

</tasks>

<verification>
- `find ui -name '*.ts' -o -name '*.tsx' | wc -l` returns 0
- `grep -r "\.ts['\"]" ui/src/ --include='*.js' | grep -v node_modules | grep "from\|import" | wc -l` returns 0 (no .ts import paths)
- `grep -r 'declare global' ui/src/ | wc -l` returns 0
- `grep 'static properties' ui/src/ui/app.js` confirms Lit static properties pattern
- `grep 'customElements.define' ui/src/ui/app.js ui/src/ui/components/resizable-divider.js` confirms element registration
</verification>

<success_criteria>
- Zero .ts or .tsx files remain in ui/
- Lit decorator files use static properties + constructor (no decorator imports)
- All internal import paths use .js extensions
- Vite and Vitest configs are .js files with correct include patterns
- index.html references main.js entry point
- ESLint passes on all converted files
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-and-extensions/05-01-SUMMARY.md`
</output>
