---
phase: 05-ui-and-extensions
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - extensions/**/*.ts -> *.js (394 files)
  - extensions/*/package.json (31 files)
autonomous: true

must_haves:
  truths:
    - "All 394 .ts files across 31 extension packages are converted to .js"
    - "All 31 package.json files have openclaw.extensions updated from ./index.ts to ./index.js"
    - "4 extensions with openclaw in dependencies have it moved to devDependencies (msteams, nostr, zalo, zalouser)"
    - "7 classes with inheritance convert correctly (private -> underscore prefix, type annotations stripped)"
    - "22 interface declarations converted to JSDoc @typedef or removed"
    - "ESLint passes on all converted extension files"
  artifacts:
    - path: "extensions/matrix/index.js"
      provides: "Converted Matrix extension entry point"
    - path: "extensions/msteams/index.js"
      provides: "Converted MS Teams extension entry point"
    - path: "extensions/voice-call/index.js"
      provides: "Converted Voice Call extension entry point"
    - path: "extensions/*/package.json"
      provides: "Updated extension configs with .js entry points"
      contains: "index.js"
  key_links:
    - from: "extensions/*/package.json"
      to: "extensions/*/index.js"
      via: "openclaw.extensions entry point"
      pattern: "index\\.js"
    - from: "extensions/**/*.js"
      to: "openclaw/plugin-sdk"
      via: "import from openclaw/plugin-sdk"
      pattern: "from.*openclaw/plugin-sdk"
---

<objective>
Convert all 31 extension packages (394 TypeScript files) to JavaScript and update their package.json configurations.

Purpose: Extensions are workspace packages under extensions/. Unlike the UI, extension import paths already use .js extensions (following the main codebase convention), so no import path rewriting is needed. The main concerns are: bulk esbuild type stripping, 7 classes with inheritance, 22 interface declarations to JSDoc, 25 files with private keyword, and updating 31 package.json files. Also fix 4 extensions that have openclaw in dependencies (should be devDependencies per CLAUDE.md).

Output: All extension .ts files converted to .js, all package.json files updated, ESLint passes.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-and-extensions/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert all 394 extension .ts files to JavaScript</name>
  <files>
    extensions/**/*.ts (394 files -> .js)
    A conversion script (convert-extensions.mjs, deleted after use)
  </files>
  <action>
Create a conversion script `convert-extensions.mjs` at project root that:

1. Recursively finds all .ts files under extensions/ (excluding .d.ts, excluding node_modules)
2. For each file, applies the established Phase 4 esbuild pipeline:
   - esbuild `transformSync` with loader: 'ts', format: 'esm' (NO keepNames to avoid __defProp/__name boilerplate)
   - Strip any `__defProp`/`__name` boilerplate that may appear (safety measure)
   - Replace `== null` / `!= null` with strict equality (word-boundary regex)
   - Add explanatory comments to empty catch blocks
   - Do NOT rewrite import paths (extensions already use .js extensions)
3. Writes .js alongside .ts, then deletes .ts
4. Reports count per extension and total

After bulk conversion, handle special cases:

**Type-only files** (interface declarations that produce empty .js after esbuild):
- Check all 22 files with interface declarations across extensions
- If esbuild produces empty/near-empty output, convert to JSDoc @typedef modules (established pattern from Phase 3-4)
- Use module-level JSDoc blocks, NOT standalone @typedef (causes ESLint parsing errors)

**Classes with inheritance** (7 files):
- Verify esbuild correctly strips type annotations from class methods and properties
- Convert `private` keyword to underscore-prefixed names (25 files affected)
- Ensure constructors with typed parameters are correctly simplified

**Fix openclaw dependency** in 4 extensions:
- extensions/msteams/package.json: move `openclaw` from `dependencies` to `devDependencies`
- extensions/nostr/package.json: same
- extensions/zalo/package.json: same
- extensions/zalouser/package.json: same
(Per CLAUDE.md: "Avoid workspace:* in dependencies; put openclaw in devDependencies or peerDependencies")

Run `pnpm check -- extensions/ --fix` to auto-format all converted files. Process in batches if needed (large extensions first: matrix, msteams, voice-call, twitch; then medium; then small).

Delete the conversion script after use.
  </action>
  <verify>
    - `find extensions -name '*.ts' -not -path '*/node_modules/*' | wc -l` returns 0
    - `grep -r '__defProp\|__name' extensions/ --include='*.js' -l | wc -l` returns 0 (no esbuild boilerplate)
    - `pnpm check -- extensions/ 2>&1 | tail -5` passes (or only pre-existing warnings)
  </verify>
  <done>All 394 extension .ts files converted to .js. Type-only files converted to JSDoc @typedef. Private fields underscore-prefixed. ESLint passes.</done>
</task>

<task type="auto">
  <name>Task 2: Update 31 extension package.json files</name>
  <files>
    extensions/*/package.json (31 files)
  </files>
  <action>
Create a small script or use a loop to update all 31 extension package.json files:

1. For each extensions/*/package.json:
   - Read JSON
   - Update `openclaw.extensions` array: replace `./index.ts` with `./index.js`
   - If the extension has `main` or `exports` fields pointing to .ts files, update those too
   - Write back with 2-space indentation + trailing newline

2. Verify the 4 openclaw-in-dependencies fixes from Task 1 (msteams, nostr, zalo, zalouser):
   - Confirm `openclaw` is in `devDependencies` (not `dependencies`)

3. Quick validation: for each extension, confirm that the file referenced in `openclaw.extensions[0]` actually exists as a .js file.

This can be done inline (no separate script needed) or via a small node one-liner.
  </action>
  <verify>
    - `grep -r '"./index.ts"' extensions/*/package.json | wc -l` returns 0 (no .ts references remain)
    - `grep -r '"./index.js"' extensions/*/package.json | wc -l` returns 31 (all updated)
    - For each extension: `ls extensions/*/index.js` all exist
    - `grep '"openclaw"' extensions/msteams/package.json` appears under devDependencies, not dependencies
  </verify>
  <done>All 31 extension package.json files updated with .js entry points. openclaw dependency moved to devDependencies in 4 extensions. Every referenced index.js file exists.</done>
</task>

</tasks>

<verification>
- `find extensions -name '*.ts' -not -path '*/node_modules/*' | wc -l` returns 0
- `grep -rn '"./index.ts"' extensions/*/package.json | wc -l` returns 0
- All 31 extensions have index.js files
- `pnpm check -- extensions/` passes
</verification>

<success_criteria>
- Zero .ts files remain in extensions/ (excluding node_modules)
- All 31 package.json files reference .js entry points
- openclaw moved from dependencies to devDependencies in msteams, nostr, zalo, zalouser
- Type-only files properly converted to JSDoc @typedef modules
- Private fields use underscore-prefix convention
- ESLint passes on all converted files
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-and-extensions/05-02-SUMMARY.md`
</output>
