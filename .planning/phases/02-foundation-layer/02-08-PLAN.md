---
phase: 02-foundation-layer
plan: 08
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/config/config.ts -> .js
  - src/config/config-paths.ts -> .js
  - src/config/defaults.ts -> .js
  - src/config/io.ts -> .js
  - src/config/schema.ts -> .js
  - src/config/validation.ts -> .js
  - src/config/plugin-auto-enable.ts -> .js
  - src/config/legacy.ts -> .js
  - src/config/legacy-migrate.ts -> .js
  - src/config/legacy.migrations.ts -> .js
  - src/config/legacy.migrations.part-1.ts -> .js
  - src/config/legacy.migrations.part-2.ts -> .js
  - src/config/legacy.migrations.part-3.ts -> .js
  - src/config/legacy.rules.ts -> .js
  - src/config/legacy.shared.ts -> .js
  - src/config/paths.ts -> .js
  - src/config/env-substitution.ts -> .js
  - src/config/env-vars.ts -> .js
  - src/config/normalize-paths.ts -> .js
  - src/config/merge-config.ts -> .js
  - src/config/merge-patch.ts -> .js
  - src/config/includes.ts -> .js
  - src/config/schema.test.ts -> .test.js
  - src/config/config-paths.test.ts -> .test.js
  - src/config/paths.test.ts -> .test.js
  - src/config/env-substitution.test.ts -> .test.js
  - src/config/includes.test.ts -> .test.js
  - src/config/normalize-paths.test.ts -> .test.js
  - src/config/plugin-auto-enable.test.ts -> .test.js
  - src/config/runtime-overrides.test.ts -> .test.js
  - src/config/io.compat.test.ts -> .test.js
  - src/config/model-alias-defaults.test.ts -> .test.js
autonomous: true

must_haves:
  truths:
    - "Core config modules (config, io, schema, validation, defaults) are JavaScript"
    - "Legacy migration system (8 files) is JavaScript with migration strategy comments"
    - "Config path resolution and env substitution modules are JavaScript"
    - "Plugin auto-enable system is JavaScript"
    - "All tests pass for converted modules"
  artifacts:
    - path: "src/config/io.js"
      provides: "Config file I/O (read, write, merge)"
    - path: "src/config/schema.js"
      provides: "Config schema validation"
    - path: "src/config/defaults.js"
      provides: "Default config values"
    - path: "src/config/validation.js"
      provides: "Config validation rules"
    - path: "src/config/legacy.migrations.ts"
      provides: "Legacy config migration barrel"
  key_links:
    - from: "src/config/io.js"
      to: "src/config/schema.js"
      via: "schema validation during config load"
      pattern: "import.*schema"
    - from: "src/config/legacy.migrations.part-1.js"
      to: "src/config/legacy.shared.js"
      via: "shared migration helpers"
      pattern: "import.*legacy.shared"
---

<objective>
Convert core config source modules, legacy migration system, and path/env modules to JavaScript.

Purpose: These are the heart of the config system -- config I/O (614 lines), schema validation (1100 lines), defaults (469 lines), and the legacy migration pipeline (8 files, ~1300 lines). They handle reading, validating, migrating, and writing config files. This is the most complex part of the config subsystem.

Output: ~32 files converted from .ts to .js with JSDoc annotations, module-level comments, and migration strategy documentation.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-foundation-layer/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert core config modules</name>
  <files>
    src/config/config.ts -> .js
    src/config/config-paths.ts -> .js
    src/config/config-paths.test.ts -> .test.js
    src/config/defaults.ts -> .js
    src/config/io.ts -> .js
    src/config/io.compat.test.ts -> .test.js
    src/config/schema.ts -> .js
    src/config/schema.test.ts -> .test.js
    src/config/validation.ts -> .js
    src/config/plugin-auto-enable.ts -> .js
    src/config/plugin-auto-enable.test.ts -> .test.js
    src/config/runtime-overrides.test.ts -> .test.js
    src/config/model-alias-defaults.test.ts -> .test.js
    src/config/includes.ts -> .js
    src/config/includes.test.ts -> .test.js
    src/config/merge-config.ts -> .js
    src/config/merge-patch.ts -> .js
  </files>
  <action>
    Convert core config modules from TypeScript to JavaScript:

    1. **Module-level comments (QUAL-04) -- especially important for:**
       - **io.ts** (614 lines): Explain the config load pipeline: read YAML -> resolve includes -> apply env substitution -> validate against schema -> apply defaults -> merge with runtime overrides. This is the central config entry point.
       - **schema.ts** (1100 lines): Explain the Zod-based config schema and what sections it validates. Note how the schema composes from individual zod-schema.*.ts modules.
       - **defaults.ts** (469 lines): Explain default value strategy and when defaults are applied.
       - **validation.ts** (361 lines): Explain validation rules beyond schema (business logic validation).
       - **plugin-auto-enable.ts** (456 lines): Explain how plugins are automatically enabled based on config.
       - **includes.ts** (249 lines): Explain config file inclusion/merging mechanism.

    2. **Strip type annotations**, remove `import type`, convert `export type` to `@typedef`. The config modules heavily import types from `./types.js` -- all `import type` references to config types should be deleted since they were type-only. Value imports from `./types.js` (if any) stay.

    3. **Remove `as` assertions** -- likely present in io.ts and schema.ts for JSON parsing results. Convert to runtime checks or remove.

    4. Add `@param`/`@returns` JSDoc on non-obvious functions (QUAL-06).

    5. Run `eslint --fix` on each converted file.

    Note: schema.ts is the largest file (1100 lines). It likely has many type annotations interspersed with Zod schema definitions. The Zod calls themselves are already JavaScript.
  </action>
  <verify>
    - `npx vitest run src/config/schema.test.js src/config/config-paths.test.js src/config/plugin-auto-enable.test.js src/config/includes.test.js src/config/io.compat.test.js src/config/runtime-overrides.test.js src/config/model-alias-defaults.test.js --reporter=verbose` passes
    - `npx eslint src/config/io.js src/config/schema.js src/config/defaults.js src/config/validation.js` passes
  </verify>
  <done>17 core config files converted. Config I/O pipeline, schema, and validation modules are JavaScript with module-level documentation. All tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Convert legacy migration system and path/env modules</name>
  <files>
    src/config/legacy.ts -> .js
    src/config/legacy-migrate.ts -> .js
    src/config/legacy.migrations.ts -> .js
    src/config/legacy.migrations.part-1.ts -> .js
    src/config/legacy.migrations.part-2.ts -> .js
    src/config/legacy.migrations.part-3.ts -> .js
    src/config/legacy.rules.ts -> .js
    src/config/legacy.shared.ts -> .js
    src/config/paths.ts -> .js
    src/config/paths.test.ts -> .test.js
    src/config/env-substitution.ts -> .js
    src/config/env-substitution.test.ts -> .test.js
    src/config/env-vars.ts -> .js
    src/config/normalize-paths.ts -> .js
    src/config/normalize-paths.test.ts -> .test.js
  </files>
  <action>
    Convert legacy migration and path modules:

    1. **Module-level comments (QUAL-04):**
       - **legacy.shared.ts** (125 lines): Explain the shared migration helpers used across all migration parts.
       - **legacy.migrations.part-1.ts** (379 lines), **part-2.ts** (414 lines), **part-3.ts** (191 lines): Explain what config versions each part migrates and the overall migration strategy (ordered rule application, backward compatibility).
       - **legacy.rules.ts** (131 lines): Explain the rule-based migration pattern.
       - **legacy.ts** (43 lines): Explain the legacy detection entry point.
       - **paths.ts** (254 lines): Explain config directory resolution strategy (XDG, platform defaults, custom paths).
       - **env-substitution.ts** (134 lines): Explain how ${ENV_VAR} substitution works in config files.

    2. **Security comments (QUAL-05):**
       - **env-substitution.ts**: Note that env substitution can inject sensitive values from environment variables into config.
       - **paths.ts**: Note that config paths determine where credentials and secrets are stored on disk.

    3. Strip type annotations, remove `import type`, convert `export type` to `@typedef`, remove `as` assertions. Run `eslint --fix`.

    Note: The legacy migration files import from `./legacy.shared.js` -- convert legacy.shared.ts first, then the parts, then the barrel (legacy.migrations.ts).
  </action>
  <verify>
    - `find src/config/ -name 'legacy*' -name '*.ts' | wc -l` returns 0
    - `npx vitest run src/config/paths.test.js src/config/env-substitution.test.js src/config/normalize-paths.test.js --reporter=verbose` passes
    - `npx eslint src/config/legacy.migrations.part-1.js src/config/paths.js src/config/env-substitution.js` passes
  </verify>
  <done>15 files converted. Legacy migration system is documented with migration strategy comments. Path and env modules have security comments. Tests pass.</done>
</task>

</tasks>

<verification>
1. No .ts files remain for any of the 32 files in this plan
2. Core config modules have detailed module-level comments explaining the config pipeline
3. Legacy migration files explain the migration strategy
4. Path and env modules have SECURITY: comments
5. All tests pass
6. ESLint passes on all converted files
</verification>

<success_criteria>
- 32 files converted from .ts to .js
- Config I/O, schema, validation, defaults are JavaScript
- Legacy migration system (8 files) is JavaScript with strategy documentation
- All tests pass
- ESLint reports no errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-foundation-layer/02-08-SUMMARY.md`
</output>
