---
phase: 02-foundation-layer
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/infra/provider-usage.ts -> .js
  - src/infra/provider-usage.test.ts -> .test.js
  - src/infra/provider-usage.auth.ts -> .js
  - src/infra/provider-usage.fetch.ts -> .js
  - src/infra/provider-usage.fetch.antigravity.ts -> .js
  - src/infra/provider-usage.fetch.antigravity.test.ts -> .test.js
  - src/infra/provider-usage.fetch.claude.ts -> .js
  - src/infra/provider-usage.fetch.codex.ts -> .js
  - src/infra/provider-usage.fetch.copilot.ts -> .js
  - src/infra/provider-usage.fetch.gemini.ts -> .js
  - src/infra/provider-usage.fetch.minimax.ts -> .js
  - src/infra/provider-usage.fetch.shared.ts -> .js
  - src/infra/provider-usage.fetch.zai.ts -> .js
  - src/infra/provider-usage.format.ts -> .js
  - src/infra/provider-usage.load.ts -> .js
  - src/infra/provider-usage.shared.ts -> .js
  - src/infra/provider-usage.types.ts -> .js
  - src/infra/shell-env.ts -> .js
  - src/infra/shell-env.test.ts -> .test.js
  - src/infra/shell-env.path.test.ts -> .test.js
  - src/infra/path-env.ts -> .js
  - src/infra/path-env.test.ts -> .test.js
  - src/infra/env.ts -> .js
  - src/infra/env.test.ts -> .test.js
  - src/infra/env-file.ts -> .js
  - src/infra/dotenv.ts -> .js
  - src/infra/dotenv.test.ts -> .test.js
  - src/infra/session-cost-usage.ts -> .js
  - src/infra/session-cost-usage.test.ts -> .test.js
  - src/infra/skills-remote.ts -> .js
autonomous: true

must_haves:
  truths:
    - "All provider-usage modules (17 files) are JavaScript with auth security comments"
    - "Shell/path/env modules are JavaScript"
    - "Session cost usage module is JavaScript"
    - "provider-usage.types.ts type exports are converted to JSDoc typedefs"
    - "All tests pass for converted modules"
  artifacts:
    - path: "src/infra/provider-usage.js"
      provides: "Provider usage tracking entry point"
    - path: "src/infra/provider-usage.auth.js"
      provides: "Provider auth token usage"
      contains: "SECURITY:"
    - path: "src/infra/provider-usage.types.js"
      provides: "Provider usage JSDoc typedefs"
    - path: "src/infra/shell-env.js"
      provides: "Shell environment detection and path resolution"
    - path: "src/infra/session-cost-usage.js"
      provides: "Session cost calculation"
  key_links:
    - from: "src/infra/provider-usage.fetch.antigravity.js"
      to: "src/infra/provider-usage.fetch.shared.js"
      via: "shared fetch helpers"
      pattern: "import.*provider-usage.fetch.shared"
    - from: "src/infra/env.js"
      to: "src/utils/boolean.js"
      via: "parseBooleanValue import"
      pattern: "import.*parseBooleanValue.*boolean"
---

<objective>
Convert provider usage tracking, shell/environment, and session cost modules in src/infra/ to JavaScript.

Purpose: The provider-usage module family (17 files) tracks API usage across AI providers -- it's a cohesive subsystem with its own type definitions and per-provider fetch implementations. The shell/env modules handle environment detection. These form a natural batch because they share no files with other infra plans.

Output: ~30 files converted from .ts to .js with JSDoc annotations and module-level comments.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-foundation-layer/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert provider-usage module family</name>
  <files>
    src/infra/provider-usage.ts -> .js
    src/infra/provider-usage.test.ts -> .test.js
    src/infra/provider-usage.auth.ts -> .js
    src/infra/provider-usage.fetch.ts -> .js
    src/infra/provider-usage.fetch.antigravity.ts -> .js
    src/infra/provider-usage.fetch.antigravity.test.ts -> .test.js
    src/infra/provider-usage.fetch.claude.ts -> .js
    src/infra/provider-usage.fetch.codex.ts -> .js
    src/infra/provider-usage.fetch.copilot.ts -> .js
    src/infra/provider-usage.fetch.gemini.ts -> .js
    src/infra/provider-usage.fetch.minimax.ts -> .js
    src/infra/provider-usage.fetch.shared.ts -> .js
    src/infra/provider-usage.fetch.zai.ts -> .js
    src/infra/provider-usage.format.ts -> .js
    src/infra/provider-usage.load.ts -> .js
    src/infra/provider-usage.shared.ts -> .js
    src/infra/provider-usage.types.ts -> .js
  </files>
  <action>
    Convert the provider-usage module family from TypeScript to JavaScript:

    1. **Start with provider-usage.types.ts** -- this file is type-only. Convert all `export type` definitions to JSDoc `@typedef` blocks. The resulting .js file will contain only JSDoc typedefs and no runtime code. This is expected and correct. Add a module-level comment explaining these are type definitions for the provider usage tracking system.

    2. **provider-usage.fetch.shared.ts** next -- shared helpers used by per-provider fetch modules.

    3. **Per-provider fetch modules** (antigravity, claude, codex, copilot, gemini, minimax, zai) -- each follows a similar pattern of fetching usage data from a specific AI provider's API. Add module-level comments naming the provider and explaining the API being called.

    4. **provider-usage.auth.ts** -- handles auth token usage tracking.
       - **SECURITY (QUAL-05):** Add SECURITY: comments explaining that this module handles provider API credentials and auth tokens. Note any token refresh or storage patterns.

    5. **Remaining files:** provider-usage.fetch.ts (barrel), provider-usage.format.ts, provider-usage.load.ts, provider-usage.shared.ts, provider-usage.ts (entry point), provider-usage.test.ts.

    6. Apply standard conversion patterns: strip type annotations, remove `import type`, `as` assertions -> optional chaining, add JSDoc on non-obvious functions. Run `eslint --fix` on each file.

    Note: provider-usage.fetch.minimax.ts is 401 lines -- the largest per-provider module. Take care with its type assertions.
  </action>
  <verify>
    - `find src/infra/ -name 'provider-usage*' -name '*.ts' | wc -l` returns 0
    - `npx vitest run src/infra/provider-usage.test.js src/infra/provider-usage.fetch.antigravity.test.js --reporter=verbose` passes
    - `npx eslint src/infra/provider-usage.js src/infra/provider-usage.auth.js src/infra/provider-usage.types.js src/infra/provider-usage.fetch.minimax.js` passes
  </verify>
  <done>17 provider-usage files converted. Type definitions are JSDoc typedefs. Auth module has SECURITY comments. Tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Convert shell/env and session cost modules</name>
  <files>
    src/infra/shell-env.ts -> .js
    src/infra/shell-env.test.ts -> .test.js
    src/infra/shell-env.path.test.ts -> .test.js
    src/infra/path-env.ts -> .js
    src/infra/path-env.test.ts -> .test.js
    src/infra/env.ts -> .js
    src/infra/env.test.ts -> .test.js
    src/infra/env-file.ts -> .js
    src/infra/dotenv.ts -> .js
    src/infra/dotenv.test.ts -> .test.js
    src/infra/session-cost-usage.ts -> .js
    src/infra/session-cost-usage.test.ts -> .test.js
    src/infra/skills-remote.ts -> .js
  </files>
  <action>
    Convert shell/environment and session cost modules:

    1. Apply standard conversion patterns from 02-RESEARCH.md.

    2. **Module-level comments (QUAL-04):**
       - shell-env.ts: Explain shell environment detection (which shell, PATH resolution)
       - path-env.ts: Explain PATH manipulation and binary resolution
       - dotenv.ts: Explain .env file loading
       - session-cost-usage.ts (294 lines): Explain how session costs are calculated from provider usage data
       - skills-remote.ts (361 lines): Explain remote skill loading/execution

    3. **Security comments (QUAL-05):**
       - env-file.ts: Note that .env files may contain secrets
       - dotenv.ts: Note that loaded env vars may include API keys

    4. Strip type annotations, remove `import type`, convert `export type` to `@typedef`, remove `as` assertions. Run `eslint --fix`.

    Note: env.ts imports from `../utils/boolean.js` (parseBooleanValue) which is converted in Plan 02-01. The import path stays the same.
  </action>
  <verify>
    - `npx vitest run src/infra/shell-env.test.js src/infra/shell-env.path.test.js src/infra/path-env.test.js src/infra/env.test.js src/infra/dotenv.test.js src/infra/session-cost-usage.test.js --reporter=verbose` passes
    - `npx eslint src/infra/shell-env.js src/infra/env.js src/infra/session-cost-usage.js src/infra/skills-remote.js` passes
  </verify>
  <done>13 files converted. Shell/env and session cost modules are JavaScript with module comments. Tests pass.</done>
</task>

</tasks>

<verification>
1. No .ts files remain for any of the 30 files in this plan
2. All converted files have module-level purpose comments
3. Provider auth module has SECURITY: comments
4. All test files pass
5. ESLint passes on all converted files
</verification>

<success_criteria>
- 30 files converted from .ts to .js
- provider-usage.types.js contains JSDoc typedefs (no runtime exports, that is OK)
- Security-sensitive modules have SECURITY: comments
- All tests pass
- ESLint reports no errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-foundation-layer/02-04-SUMMARY.md`
</output>
