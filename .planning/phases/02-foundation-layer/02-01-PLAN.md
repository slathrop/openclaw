---
phase: 02-foundation-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/ (DELETE all 9 .d.ts files)
  - src/shared/text/reasoning-tags.ts -> .js
  - src/shared/text/reasoning-tags.test.ts -> .test.js
  - src/utils/account-id.ts -> .js
  - src/utils/boolean.ts -> .js
  - src/utils/boolean.test.ts -> .test.js
  - src/utils/delivery-context.ts -> .js
  - src/utils/delivery-context.test.ts -> .test.js
  - src/utils/directive-tags.ts -> .js
  - src/utils/message-channel.ts -> .js
  - src/utils/message-channel.test.ts -> .test.js
  - src/utils/provider-utils.ts -> .js
  - src/utils/queue-helpers.ts -> .js
  - src/utils/shell-argv.ts -> .js
  - src/utils/time-format.ts -> .js
  - src/utils/usage-format.ts -> .js
  - src/utils/usage-format.test.ts -> .test.js
  - src/utils.ts -> .js
  - src/utils.test.ts -> .test.js
autonomous: true

must_haves:
  truths:
    - "All 9 .d.ts files in src/types/ are deleted"
    - "No .ts files remain in src/shared/ or src/utils/"
    - "src/utils.ts is renamed to src/utils.js with type annotations stripped"
    - "Every converted module has a top-level purpose comment (QUAL-04)"
    - "Tests pass for converted modules"
  artifacts:
    - path: "src/shared/text/reasoning-tags.js"
      provides: "Reasoning tag extraction utilities"
    - path: "src/utils.js"
      provides: "Root utility module (sleep, resolveConfigDir, etc.)"
    - path: "src/utils/message-channel.js"
      provides: "Message channel normalization and validation"
    - path: "src/utils/usage-format.js"
      provides: "Usage cost formatting"
  key_links:
    - from: "src/utils/boolean.js"
      to: "src/infra/env.ts"
      via: "parseBooleanValue import"
      pattern: "import.*parseBooleanValue.*boolean"
    - from: "src/utils.js"
      to: "src/infra/retry.ts"
      via: "sleep import"
      pattern: "import.*sleep.*utils"
---

<objective>
Convert leaf modules (types, shared, utils) to JavaScript and delete TypeScript ambient declarations.

Purpose: These are the dependency leaves -- no other in-scope modules depend on them being converted first, but converting them establishes the conversion patterns (type stripping, JSDoc, module comments) that all subsequent plans follow. Deleting src/types/*.d.ts removes TypeScript-only artifacts that have no runtime purpose.

Output: 9 files deleted, ~18 files converted from .ts to .js with JSDoc annotations and module-level comments.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-foundation-layer/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete src/types/ ambient declarations</name>
  <files>
    src/types/cli-highlight.d.ts
    src/types/lydell-node-pty.d.ts
    src/types/napi-rs-canvas.d.ts
    src/types/node-edge-tts.d.ts
    src/types/node-llama-cpp.d.ts
    src/types/osc-progress.d.ts
    src/types/pdfjs-dist-legacy.d.ts
    src/types/proper-lockfile.d.ts
    src/types/qrcode-terminal.d.ts
  </files>
  <action>
    Delete all 9 .d.ts files in src/types/. These are TypeScript ambient module declarations for untyped npm packages. They have no runtime purpose in JavaScript.

    After deletion, remove the src/types/ directory if empty. Also check tsconfig.json or any config that references src/types/ and remove those references if they exist.

    Do NOT create any replacement files. JavaScript does not need ambient declarations.
  </action>
  <verify>
    `ls src/types/` should show the directory does not exist or is empty.
    `git status` shows the 9 .d.ts files as deleted.
  </verify>
  <done>All 9 .d.ts files deleted, src/types/ directory removed.</done>
</task>

<task type="auto">
  <name>Task 2: Convert src/shared/ and src/utils/ to JavaScript</name>
  <files>
    src/shared/text/reasoning-tags.ts -> src/shared/text/reasoning-tags.js
    src/shared/text/reasoning-tags.test.ts -> src/shared/text/reasoning-tags.test.js
    src/utils/account-id.ts -> src/utils/account-id.js
    src/utils/boolean.ts -> src/utils/boolean.js
    src/utils/boolean.test.ts -> src/utils/boolean.test.js
    src/utils/delivery-context.ts -> src/utils/delivery-context.js
    src/utils/delivery-context.test.ts -> src/utils/delivery-context.test.js
    src/utils/directive-tags.ts -> src/utils/directive-tags.js
    src/utils/message-channel.ts -> src/utils/message-channel.js
    src/utils/message-channel.test.ts -> src/utils/message-channel.test.js
    src/utils/provider-utils.ts -> src/utils/provider-utils.js
    src/utils/queue-helpers.ts -> src/utils/queue-helpers.js
    src/utils/shell-argv.ts -> src/utils/shell-argv.js
    src/utils/time-format.ts -> src/utils/time-format.js
    src/utils/usage-format.ts -> src/utils/usage-format.js
    src/utils/usage-format.test.ts -> src/utils/usage-format.test.js
    src/utils.ts -> src/utils.js
    src/utils.test.ts -> src/utils.test.js
  </files>
  <action>
    For each file, apply these conversion patterns from the research:

    1. **Read the .ts file**, then **write the .js file** with conversions applied, then **delete the .ts file**.

    2. **Module-level comment (QUAL-04):** Add a top-of-file JSDoc comment block explaining the module's purpose. Keep it concise -- 2-4 lines describing what the module does and why.

    3. **Strip type annotations:** Remove TypeScript type annotations from parameters, return types, and variable declarations. Add JSDoc `@param` and `@returns` annotations on non-obvious functions (QUAL-06).

    4. **Remove `import type` statements:** Delete lines that are `import type { ... }` entirely. For mixed imports like `import { foo, type Bar }`, keep only the value imports: `import { foo }`.

    5. **Convert `export type` to JSDoc `@typedef`:** Transform exported type aliases into JSDoc `@typedef` blocks. Example:
       ```javascript
       /**
        * @typedef {object} MessageChannel
        * @property {string} type - Channel type identifier.
        * @property {string} id - Channel-specific identifier.
        */
       ```

    6. **Remove `as` assertions:** Convert `(err as { code?: unknown }).code` to `err?.code` or explicit runtime checks. Remove simple `as Type` casts (e.g., `JSON.parse(raw) as Foo` becomes `JSON.parse(raw)`).

    7. **Replace TS-only types in JSDoc:** Use `{object}` for `NodeJS.ProcessEnv`, `{*}` for `NodeJS.Timeout`, and `{*}` for complex generic types.

    8. **Run `eslint --fix`** on each converted file to apply Google Style formatting (single quotes, semicolons, 2-space indent, no trailing commas).

    9. **Import paths stay as-is:** All imports already use `.js` extensions. Do not change them.

    For test files, the conversion is minimal -- mostly strip occasional type annotations in test helpers and change double quotes to single quotes. Tests rarely have type annotations.

    Process files in this order: src/shared/ first, then src/utils/ directory files, then src/utils.ts and src/utils.test.ts last (since some utils dir files may be imported by src/utils.ts).
  </action>
  <verify>
    Run these checks:
    - `find src/shared/ src/utils/ -name '*.ts' | wc -l` should output 0 (no .ts files remain)
    - `ls src/utils.ts 2>/dev/null` should show file not found
    - `npx eslint src/shared/ src/utils/ src/utils.js src/utils.test.js` should pass with no errors
    - `npx vitest run src/shared/text/reasoning-tags.test.js src/utils/boolean.test.js src/utils/delivery-context.test.js src/utils/message-channel.test.js src/utils/usage-format.test.js src/utils.test.js --reporter=verbose` should show all tests passing
  </verify>
  <done>
    All 18 files converted from .ts to .js. No .ts files remain in src/shared/ or src/utils/. All converted files have module-level comments. Tests pass. ESLint passes.
  </done>
</task>

</tasks>

<verification>
1. `find src/types/ -name '*.d.ts' 2>/dev/null | wc -l` returns 0
2. `find src/shared/ src/utils/ -name '*.ts' | wc -l` returns 0
3. `ls src/utils.ts 2>/dev/null` returns nothing (file gone)
4. All converted test files pass when run with vitest
5. ESLint passes on all converted files
</verification>

<success_criteria>
- Zero .ts files in src/types/, src/shared/, src/utils/
- src/utils.js exists and exports the same functions as the old src/utils.ts
- Every converted .js file has a top-of-file module purpose comment
- All tests pass for converted modules
- ESLint reports no errors on converted files
</success_criteria>

<output>
After completion, create `.planning/phases/02-foundation-layer/02-01-SUMMARY.md`
</output>
