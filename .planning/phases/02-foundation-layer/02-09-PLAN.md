---
phase: 02-foundation-layer
plan: 09
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/config/agent-dirs.ts -> .js
  - src/config/agent-limits.ts -> .js
  - src/config/cache-utils.ts -> .js
  - src/config/channel-capabilities.ts -> .js
  - src/config/channel-capabilities.test.ts -> .test.js
  - src/config/commands.ts -> .js
  - src/config/commands.test.ts -> .test.js
  - src/config/group-policy.ts -> .js
  - src/config/logging.ts -> .js
  - src/config/markdown-tables.ts -> .js
  - src/config/port-defaults.ts -> .js
  - src/config/runtime-overrides.ts -> .js
  - src/config/sessions.ts -> .js (barrel)
  - src/config/sessions.test.ts -> .test.js
  - src/config/sessions.cache.test.ts -> .test.js
  - src/config/talk.ts -> .js
  - src/config/telegram-custom-commands.ts -> .js
  - src/config/telegram-custom-commands.test.ts -> .test.js (if exists)
  - src/config/test-helpers.ts -> .js
  - src/config/version.ts -> .js
  - src/config/sessions/ (all 11 files -> .js)
  - Remaining config test files (all .test.ts -> .test.js)
autonomous: true

must_haves:
  truths:
    - "All remaining config source modules are JavaScript"
    - "Config sessions subsystem (barrel + 9 source + 2 tests) is JavaScript"
    - "All config test files are JavaScript"
    - "No .ts files remain anywhere in src/config/"
    - "All tests pass for the entire config directory"
  artifacts:
    - path: "src/config/channel-capabilities.js"
      provides: "Channel capability detection"
    - path: "src/config/group-policy.js"
      provides: "Group policy configuration"
    - path: "src/config/sessions.js"
      provides: "Session config barrel"
    - path: "src/config/sessions/cache.js"
      provides: "Session cache management"
  key_links:
    - from: "src/config/sessions.js"
      to: "src/config/sessions/"
      via: "barrel re-export"
      pattern: "export.*sessions/"
    - from: "src/config/channel-capabilities.js"
      to: "src/config/types.channels.js"
      via: "channel type imports"
      pattern: "import.*types"
---

<objective>
Convert remaining config modules, sessions subsystem, and all config test files to JavaScript.

Purpose: This completes the config directory conversion. It covers the remaining source modules (channel capabilities, commands, group policy, sessions, etc.) and ensures ALL config test files are converted. After this plan, zero .ts files remain in src/config/.

Output: ~56 files converted from .ts to .js, completing the config directory.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-foundation-layer/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert remaining config source modules</name>
  <files>
    src/config/agent-dirs.ts -> .js
    src/config/agent-limits.ts -> .js
    src/config/cache-utils.ts -> .js
    src/config/channel-capabilities.ts -> .js
    src/config/commands.ts -> .js
    src/config/group-policy.ts -> .js
    src/config/logging.ts -> .js
    src/config/markdown-tables.ts -> .js
    src/config/port-defaults.ts -> .js
    src/config/runtime-overrides.ts -> .js
    src/config/talk.ts -> .js
    src/config/telegram-custom-commands.ts -> .js
    src/config/test-helpers.ts -> .js
    src/config/version.ts -> .js
  </files>
  <action>
    Convert each remaining config source module:

    1. Apply standard conversion patterns from 02-RESEARCH.md.

    2. **Module-level comments (QUAL-04):**
       - **agent-dirs.ts** (107 lines): Explain agent directory resolution and multi-agent layouts.
       - **channel-capabilities.ts** (73 lines): Explain what channel capabilities are and how they're detected.
       - **commands.ts** (64 lines): Explain CLI command registration/discovery from config.
       - **group-policy.ts** (213 lines): Explain group policy configuration for multi-user scenarios.
       - **telegram-custom-commands.ts** (95 lines): Explain Telegram bot custom command configuration.
       - **talk.ts** (49 lines): Explain voice/TTS configuration.

    3. **Security comments (QUAL-05):**
       - **group-policy.ts**: Note that group policies control access and permissions.

    4. Strip type annotations, remove `import type`, convert `export type` to `@typedef`, remove `as` assertions. Run `eslint --fix`.

    Note: Most of these files are small (under 100 lines). Quick conversions.
  </action>
  <verify>
    - `npx eslint src/config/agent-dirs.js src/config/channel-capabilities.js src/config/group-policy.js src/config/commands.js` passes
  </verify>
  <done>14 remaining config source files converted with module comments.</done>
</task>

<task type="auto">
  <name>Task 2: Convert sessions subsystem and all config test files</name>
  <files>
    src/config/sessions.ts -> .js (barrel)
    src/config/sessions/ (all .ts files -> .js)
    All remaining src/config/*.test.ts files -> .test.js
  </files>
  <action>
    **Part A: Sessions subsystem**

    First, list all files in src/config/sessions/:
    ```
    find src/config/sessions/ -name '*.ts' | sort
    ```

    Convert the sessions directory (9 source + 2 test files) plus the barrel (src/config/sessions.ts):

    1. Convert source files first, then tests, then the barrel last.
    2. **Module-level comments (QUAL-04):** Add purpose comments explaining what each session module does (cache management, session persistence, session lifecycle).
    3. Apply standard conversion patterns. Run `eslint --fix`.

    **Part B: All remaining config test files**

    List all unconverted test files:
    ```
    find src/config/ -name '*.test.ts' | sort
    ```

    Convert every remaining .test.ts file to .test.js. These test files should have been partially handled by Plans 02-07 and 02-08 alongside their source files. This task catches any that were missed and converts any remaining ones.

    Config test files have these patterns:
    - `config.*.test.ts` files (27+ files) -- named test files for specific config behaviors
    - `sessions.test.ts`, `sessions.cache.test.ts` -- session tests
    - `slack-*.test.ts`, `telegram-*.test.ts`, `ui-seam-color.test.ts` -- channel-specific config tests

    For test files, conversion is minimal: strip occasional type annotations, change double quotes to single quotes, remove `import type`. Most test files have very little TypeScript.

    Run `eslint --fix` on each converted test file.

    **Final check:** After converting everything, verify zero .ts files remain in src/config/:
    ```
    find src/config/ -name '*.ts' | wc -l
    ```
    This MUST return 0.
  </action>
  <verify>
    - `find src/config/ -name '*.ts' | wc -l` returns 0 (CRITICAL -- no .ts files remain)
    - `npx vitest run src/config/ --reporter=verbose` runs ALL config tests and they pass
    - `npx eslint src/config/` passes on the entire directory
  </verify>
  <done>Sessions subsystem and all remaining config test files converted. Zero .ts files remain in src/config/. All config tests pass.</done>
</task>

</tasks>

<verification>
1. `find src/config/ -name '*.ts' | wc -l` returns 0 -- this is the primary gate
2. `npx vitest run src/config/` passes all tests
3. `npx eslint src/config/` passes
4. All files have module-level comments
5. Sessions subsystem is complete
</verification>

<success_criteria>
- ZERO .ts files remain anywhere in src/config/ (including sessions/ subdirectory)
- All config test files are .test.js
- Full config test suite passes via `npx vitest run src/config/`
- ESLint passes on entire config directory
</success_criteria>

<output>
After completion, create `.planning/phases/02-foundation-layer/02-09-SUMMARY.md`
</output>
