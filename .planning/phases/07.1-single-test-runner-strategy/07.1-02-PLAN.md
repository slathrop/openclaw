---
phase: 07.1-single-test-runner-strategy
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - /Users/slathrop/.claude/agents/gsd-executor.md
  - /Users/slathrop/.claude/agents/gsd-planner.md
autonomous: true

must_haves:
  truths:
    - "Executor agents know to use targeted tests (not full suite) during parallel wave execution"
    - "Executor agents use --no-verify for commits during parallel waves"
    - "Planner agents write <verify> elements with targeted tests for parallel wave plans"
    - "Planner agents reference parallel-testing.md in plan templates"
  artifacts:
    - path: "/Users/slathrop/.claude/agents/gsd-executor.md"
      provides: "Parallel wave testing guidance for executors"
      contains: "vitest run"
    - path: "/Users/slathrop/.claude/agents/gsd-planner.md"
      provides: "Plan template guidance for targeted verification"
      contains: "parallel-testing"
  key_links:
    - from: "gsd-executor.md"
      to: "parallel-testing.md"
      via: "reference link"
      pattern: "parallel-testing"
    - from: "gsd-planner.md"
      to: "parallel-testing.md"
      via: "reference link"
      pattern: "parallel-testing"
---

<objective>
Update GSD executor and planner agent definitions with parallel wave testing guidance.

Purpose: The executor and planner agents need explicit guidance on the new testing strategy. Executors must know to use targeted tests (not full suite) during parallel waves and to commit with --no-verify. Planners must know to write <verify> elements with targeted tests for parallel wave plans.

Output: Modified gsd-executor.md with parallel testing section; modified gsd-planner.md with updated plan template guidance.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-single-test-runner-strategy/07.1-RESEARCH.md
@/Users/slathrop/.claude/agents/gsd-executor.md
@/Users/slathrop/.claude/agents/gsd-planner.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update gsd-executor.md with parallel wave testing guidance</name>
  <files>/Users/slathrop/.claude/agents/gsd-executor.md</files>
  <action>
Add a new section `<parallel_wave_testing>` to gsd-executor.md. Insert it AFTER the `<task_commit_protocol>` section and BEFORE the `<summary_creation>` section.

The section should contain:

1. **Title:** "Parallel Wave Testing Protocol"

2. **Context paragraph:** "When executing plans within a parallel wave (multiple agents running simultaneously), use targeted tests instead of the full test suite. The execute-phase orchestrator runs a full test suite once at the wave boundary. This eliminates redundant test runs and CPU contention."

3. **During parallel wave execution rules:**
   - For task `<verify>` steps: Run ONLY the targeted test specified in the plan (e.g., `npx vitest run --maxWorkers=1 path/to/test.js`). Do NOT run `pnpm test` (full suite).
   - If the plan's `<verify>` says `pnpm test` but you are in a parallel wave: downgrade to targeted test for the files you modified. Use `npx vitest run --related path/to/modified.js --maxWorkers=2` or the colocated test file.
   - For git commits: Use `--no-verify` flag to skip the pre-commit hook. The hook runs `eslint --fix` globally which causes race conditions with parallel agents. Example: `git commit --no-verify -m "feat(08-01): description"`
   - The wave-level lint gate (`pnpm check`) runs after all agents complete, replacing per-commit linting.

4. **How to know if you're in a parallel wave:**
   - The orchestrator's spawn prompt will include the wave context
   - If your plan's frontmatter has `wave: N` and other plans share the same wave number, you're parallel
   - When in doubt, use targeted tests -- it's always safe

5. **Targeted test patterns (quick reference):**
   ```
   # Run specific test file (fastest)
   npx vitest run --maxWorkers=1 src/gateway/auth.test.js

   # Run tests related to a changed source file
   npx vitest run --related src/gateway/auth.js --maxWorkers=2

   # Run tests matching a pattern
   npx vitest run --maxWorkers=1 -t "auth middleware"
   ```

6. **Reference:** "See /Users/slathrop/.claude/get-shit-done/references/parallel-testing.md for full guidance."

Additionally, update the `<task_commit_protocol>` section's step 4 "Craft commit message" to add a note about --no-verify:

After the existing git commit example, add:
```
**During parallel wave execution:** Add --no-verify to skip pre-commit hook:
git commit --no-verify -m "{type}({phase}-{plan}): {description}"
```

Do NOT modify any other sections. Do NOT change the role, execution_flow, deviation_rules, checkpoint_protocol, or summary_creation sections.
  </action>
  <verify>
Read the modified gsd-executor.md and confirm:
- A `parallel_wave_testing` section exists
- The section contains `vitest run --maxWorkers=1` patterns
- The section references parallel-testing.md
- The task_commit_protocol section mentions `--no-verify`
  </verify>
  <done>
gsd-executor.md contains parallel wave testing guidance with targeted test patterns, --no-verify commit instructions, and reference to parallel-testing.md.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update gsd-planner.md with targeted verification guidance</name>
  <files>/Users/slathrop/.claude/agents/gsd-planner.md</files>
  <action>
Make two targeted additions to gsd-planner.md:

1. **In the `<task_breakdown>` section, under "Task Anatomy"** -- after the existing `<verify>` field description, add a subsection:

   ```
   **Verification in parallel waves:**

   When writing `<verify>` elements for tasks in plans that will execute in parallel waves
   (wave with multiple plans), use targeted tests instead of `pnpm test`:

   - GOOD: `npx vitest run --maxWorkers=1 src/gateway/auth.test.js`
   - GOOD: `npx vitest run --related src/gateway/auth.js --maxWorkers=2`
   - BAD: `pnpm test` (runs full suite; causes CPU contention with parallel agents)
   - BAD: `pnpm check` (pre-commit hook handles this; wave-level lint gate replaces it)

   The execute-phase orchestrator runs `pnpm test` + `pnpm check` once at the wave
   boundary. Individual agent tasks only need targeted verification.

   See /Users/slathrop/.claude/get-shit-done/references/parallel-testing.md
   ```

2. **In the `<plan_format>` section** -- in the "PLAN.md Structure" template, update the `<execution_context>` block to include the parallel-testing reference. Add this line after the existing references:

   ```
   @/Users/slathrop/.claude/get-shit-done/references/parallel-testing.md
   ```

   So the execution_context block becomes:
   ```
   <execution_context>
   @/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
   @/Users/slathrop/.claude/get-shit-done/templates/summary.md
   @/Users/slathrop/.claude/get-shit-done/references/parallel-testing.md
   </execution_context>
   ```

Do NOT modify any other sections. Do NOT change the philosophy, discovery_levels, dependency_graph, scope_estimation, goal_backward, checkpoints, tdd_integration, gap_closure_mode, revision_mode, execution_flow, structured_returns, or success_criteria sections.
  </action>
  <verify>
Read the modified gsd-planner.md and confirm:
- The task_breakdown section contains "Verification in parallel waves" guidance
- The guidance includes `vitest run --maxWorkers=1` and `vitest run --related` examples
- The plan_format section's execution_context includes parallel-testing.md reference
  </verify>
  <done>
gsd-planner.md contains parallel wave verification guidance in task anatomy and references parallel-testing.md in the plan template.
  </done>
</task>

</tasks>

<verification>
1. gsd-executor.md has parallel_wave_testing section with targeted test patterns
2. gsd-executor.md task_commit_protocol mentions --no-verify for parallel waves
3. gsd-planner.md task_breakdown has "Verification in parallel waves" subsection
4. gsd-planner.md plan_format execution_context includes parallel-testing.md
5. Both files reference parallel-testing.md
</verification>

<success_criteria>
- Executor agents have clear, actionable guidance for parallel wave testing behavior
- Planner agents know to write targeted verify elements for parallel wave plans
- Both agents reference the parallel-testing.md reference doc for details
- Changes are additive -- no existing behavior modified or removed
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-single-test-runner-strategy/07.1-02-SUMMARY.md`
</output>
