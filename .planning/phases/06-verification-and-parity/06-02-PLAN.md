---
phase: 06-verification-and-parity
plan: 02
type: execute
wave: 2
depends_on: [06-01]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All CLI commands execute correctly and display expected output"
    - "Gateway server starts and accepts WebSocket connections"
    - "Agent CLI command accepts input and routes to runtime"
    - "Configuration loading, validation, and modification work correctly"
  artifacts: []
  key_links:
    - from: "src/cli/program.js"
      to: "src/commands/*.js"
      via: "commander command registration"
      pattern: "addCommand"
---

<objective>
Verify all CLI commands, gateway server, agent runtime, and configuration work identically to the TypeScript version.

Purpose: Confirm the core CLI user experience is preserved after conversion.
Output: Documented verification that all CLI commands function correctly.
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-verification-and-parity/06-RESEARCH.md
@.planning/phases/06-verification-and-parity/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify CLI commands and help output</name>
  <files>None (verification only)</files>
  <action>
Test all major CLI commands for correct execution:

**1. Help and version output:**
```bash
pnpm openclaw --help
pnpm openclaw --version
```
Verify commands list is complete and version displays correctly.

**2. Status commands:**
```bash
pnpm openclaw status --help
pnpm openclaw status --all 2>&1 | head -50
```
Status should display gateway state, channels, and agent info.

**3. Config commands:**
```bash
pnpm openclaw config --help
pnpm openclaw config get
pnpm openclaw config list
```
Config should read and display current configuration.

**4. Doctor command:**
```bash
pnpm openclaw doctor --help
pnpm openclaw doctor 2>&1 | head -30
```
Doctor should run diagnostics and report issues.

**5. Channels commands:**
```bash
pnpm openclaw channels --help
pnpm openclaw channels status 2>&1 | head -30
```
Channels should list configured channel status.

**6. Models command:**
```bash
pnpm openclaw models --help
pnpm openclaw models list 2>&1 | head -30
```
Models should list available AI providers and models.

**7. Agent command (dry run):**
```bash
pnpm openclaw agent --help
pnpm openclaw agent --message "test" --dry-run 2>&1 | head -30
```
Agent command should accept message input and route to runtime (dry-run verifies CLI wiring without full agent processing; agent runtime logic is covered by unit tests in Plan 06-01).
  </action>
  <verify>
Each command executes without JavaScript errors (no "is not defined", "cannot read property", "module not found").
All commands display appropriate help text and output.
  </verify>
  <done>
- `openclaw --help` displays full command list
- `openclaw status` runs without error
- `openclaw config get` displays configuration
- `openclaw doctor` runs diagnostics
- `openclaw channels status` shows channel states
- `openclaw models list` shows available models
- `openclaw agent --message --dry-run` accepts input and routes to runtime
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify gateway server startup</name>
  <files>None (verification only)</files>
  <action>
Test gateway server can start and accept connections:

**1. Start gateway in background:**
```bash
timeout 10 pnpm openclaw gateway run --bind loopback --port 18789 --force 2>&1 &
GATEWAY_PID=$!
sleep 3
```

**2. Verify listening:**
```bash
lsof -i :18789 | grep LISTEN || ss -ltnp | grep 18789
```

**3. Test WebSocket connection (if wscat available, otherwise curl):**
```bash
# Simple HTTP health check
curl -s http://127.0.0.1:18789/health || echo "No health endpoint"
```

**4. Stop gateway:**
```bash
kill $GATEWAY_PID 2>/dev/null || true
pkill -f "openclaw gateway" 2>/dev/null || true
```

If gateway fails to start, capture error output and diagnose the issue.
  </action>
  <verify>
Gateway process starts without JavaScript errors.
Port 18789 shows LISTEN state.
Gateway accepts connections (or gracefully handles connection attempts).
  </verify>
  <done>
- Gateway server starts without crash
- Server binds to specified port
- Server stops cleanly
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>CLI commands and gateway server execution verified via automated testing</what-built>
  <how-to-verify>
Review the command outputs from Tasks 1 and 2:

1. **CLI commands**: All major commands should execute without JavaScript errors
2. **Gateway**: Server should start, bind to port, and accept connections
3. **Any failures**: Note which commands failed and what error messages appeared

If you have the gateway running locally, you can also test:
- Open http://localhost:18789 in browser (if control UI enabled)
- Run `openclaw channels status --probe` to test channel connectivity
  </how-to-verify>
  <resume-signal>Type "approved" if CLI and gateway work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. All CLI help commands display without errors
2. `openclaw status` shows current state
3. `openclaw config get` displays configuration
4. `openclaw gateway run` starts successfully
5. Gateway binds to specified port
6. No JavaScript runtime errors (undefined, null reference, etc.)
</verification>

<success_criteria>
- All CLI commands execute correctly (`openclaw gateway run`, `openclaw channels status`, `openclaw agent --message`, `openclaw config`, `openclaw status`, `openclaw doctor`)
- Gateway server starts and accepts WebSocket connections
- Configuration loading, validation, and modification work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/06-verification-and-parity/06-02-SUMMARY.md`
</output>
