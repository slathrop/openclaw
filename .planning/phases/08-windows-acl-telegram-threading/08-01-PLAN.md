---
phase: 08-windows-acl-telegram-threading
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/browser-cli-extension.js
  - src/security/windows-acl.test.js
  - src/security/windows-acl.js
  - src/commands/registry.js
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Bundled chrome extension assets resolve correctly"
    - "Windows ACL parsing has test coverage"
    - "Windows ACL tests are stable across platforms"
    - "Command auth registry matches upstream"
  artifacts:
    - path: "src/security/windows-acl.test.js"
      provides: "Windows ACL test coverage"
      contains: "parseIcaclsOutput|summarizeWindowsAcl"
    - path: "src/cli/browser-cli-extension.js"
      provides: "Chrome extension asset resolution"
      contains: "bundled.*extension|chrome.*extension"
  key_links:
    - from: "src/security/windows-acl.test.js"
      to: "src/security/windows-acl.js"
      via: "import and test"
      pattern: "import.*windows-acl"
---

<objective>
Port chrome extension asset fix and Windows ACL test coverage (SYNC-022 to SYNC-024)

Purpose: Complete the chrome extension path resolution and add comprehensive Windows ACL test coverage
Output: Three commits matching upstream (SYNC-022, SYNC-023, SYNC-024)
</objective>

<execution_context>
@/Users/slathrop/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slathrop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-windows-acl-telegram-threading/08-RESEARCH.md
</context>

<upstream_workflow>
For each commit in this plan:
1. Fetch and show upstream diff: `git fetch upstream && git show <hash> --stat && git show <hash>`
2. Understand the change (read PR if needed: `gh pr view <number> --repo openclaw/openclaw`)
3. Apply equivalent JavaScript change to local files
4. Run targeted tests: `pnpm vitest run <relevant-test-file>`
5. Commit with --no-verify (wave-level test gate handles full suite): `scripts/committer --no-verify "<message>" <files...>`
</upstream_workflow>

<tasks>

<task type="auto">
  <name>Task 1: SYNC-022 - Resolve bundled chrome extension assets</name>
  <files>src/cli/browser-cli-extension.js</files>
  <action>
Port commit 1ee1522da (fix: resolve bundled chrome extension assets (#8914))

1. Read the upstream diff:
   ```bash
   git fetch upstream
   git show 1ee1522da --stat
   git show 1ee1522da
   ```

2. Understand the change:
   - This is a continuation of the SYNC-018/019/020/021 work from Phase 7
   - Fixes how bundled chrome extension assets are resolved
   - The PR #8914 likely adds or adjusts path candidates for asset lookup

3. Apply the equivalent JavaScript changes:
   - Update browser-cli-extension.js with the asset resolution fix
   - Follow the pattern from SYNC-018/020 (candidate paths + hasManifest check)
   - Translate any TypeScript-specific code to JavaScript

4. Run targeted tests:
   ```bash
   pnpm vitest run src/cli/browser-cli-extension.test.js
   ```

5. Commit with matching message:
   ```bash
   scripts/committer --no-verify "fix: resolve bundled chrome extension assets (#8914)" src/cli/browser-cli-extension.js
   ```
  </action>
  <verify>`pnpm vitest run src/cli/browser-cli-extension.test.js` passes, `git log -1` shows correct message</verify>
  <done>Commit 1ee1522da ported as SYNC-022, chrome extension assets resolve correctly</done>
</task>

<task type="auto">
  <name>Task 2: SYNC-023 - Add Windows ACL test coverage</name>
  <files>src/security/windows-acl.test.js</files>
  <action>
Port commit f26cc6087 (Tests: add test coverage for security/windows-acl.ts)

1. Read the upstream diff:
   ```bash
   git show f26cc6087 --stat
   git show f26cc6087
   ```

2. Understand the change:
   - Creates a NEW test file for windows-acl module
   - Production code already exists: `src/security/windows-acl.js`
   - Known exports to test: `parseIcaclsOutput`, `summarizeWindowsAcl`, `resolveWindowsUserPrincipal`, `inspectWindowsAcl`, `formatWindowsAclSummary`, `formatIcaclsResetCommand`, `createIcaclsResetCommand`
   - Tests should use vitest (describe, it, expect, vi)

3. Create the test file (translate from upstream TypeScript):
   - Strip TypeScript type annotations
   - Convert `import type` to standard imports or remove
   - Keep all test logic and assertions
   - Mock `exec` calls for icacls output simulation
   - Mock `os.userInfo()` and `process.env` for USERNAME/USERDOMAIN

4. Run the new tests:
   ```bash
   pnpm vitest run src/security/windows-acl.test.js
   ```

5. Commit with matching message:
   ```bash
   scripts/committer --no-verify "Tests: add test coverage for security/windows-acl.ts" src/security/windows-acl.test.js
   ```

Note: Keep the upstream commit message which references .ts (not .js) for 1:1 parity.
  </action>
  <verify>`pnpm vitest run src/security/windows-acl.test.js` passes, `git log -1` shows correct message</verify>
  <done>Commit f26cc6087 ported as SYNC-023, Windows ACL module has comprehensive test coverage</done>
</task>

<task type="auto">
  <name>Task 3: SYNC-024 - Stabilize Windows ACL tests + command auth registry</name>
  <files>src/security/windows-acl.test.js, src/security/windows-acl.js, src/commands/registry.js (or equivalent)</files>
  <action>
Port commit d6cde28c8 (fix: stabilize windows acl tests + command auth registry (#9335))

1. Read the upstream diff:
   ```bash
   git show d6cde28c8 --stat
   git show d6cde28c8
   ```

2. Understand the change:
   - Stabilizes the Windows ACL tests added in SYNC-023 (likely mocking environment assumptions)
   - Also includes command auth registry changes (separate concern bundled in same commit)
   - Test stabilization likely involves: mocking os.userInfo(), process.env.USERNAME, process.env.USERDOMAIN
   - Command auth registry may add or modify how commands register their auth requirements

3. Apply the equivalent JavaScript changes:
   - Update test file with environment mocking for cross-platform stability
   - Apply command auth registry changes (translate TypeScript to JavaScript if needed)
   - Both changes should be in the same commit per upstream parity

4. Run targeted tests:
   ```bash
   pnpm vitest run src/security/windows-acl.test.js
   ```

5. Commit with matching message:
   ```bash
   scripts/committer --no-verify "fix: stabilize windows acl tests + command auth registry (#9335)" <affected files>
   ```
  </action>
  <verify>`pnpm vitest run src/security/windows-acl.test.js` passes, `git log -1` shows correct message</verify>
  <done>Commit d6cde28c8 ported as SYNC-024, Windows ACL tests are stable and command auth registry updated</done>
</task>

</tasks>

<verification>
After all 3 tasks complete:
1. `git log -3 --oneline` shows three commits in correct order
2. `pnpm vitest run src/security/windows-acl.test.js` passes
3. `pnpm vitest run src/cli/browser-cli-extension.test.js` passes
4. Commits match upstream messages:
   - fix: resolve bundled chrome extension assets (#8914)
   - Tests: add test coverage for security/windows-acl.ts
   - fix: stabilize windows acl tests + command auth registry (#9335)
</verification>

<success_criteria>
- 3 commits created matching SYNC-022, SYNC-023, SYNC-024
- Windows ACL test file exists and passes
- Chrome extension asset resolution works
- Targeted tests pass after each commit
</success_criteria>

<output>
After completion, create `.planning/phases/08-windows-acl-telegram-threading/08-01-SUMMARY.md`
</output>
